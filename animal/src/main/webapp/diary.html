<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Slid Menu</title>
    <!--  내가만든 less들  -->
    <link href="css/sh_diary.less" type="style.less" rel="stylesheet/less" />
    <link href="css/sh_slidmenu_header.less" type="style.less" rel="stylesheet/less" />

    <!--  폰트아이콘 링크  -->
    <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="css/icon-font.min.css" rel="stylesheet" />

    <!-- 캘린더 css -->
    <link href="lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet' type='text/css' />
    <link href='lib/fullcalendar/fullcalendar.css' rel='stylesheet' />
    <link href='lib/fullcalendar/fullcalendar.print.css' rel='stylesheet' tpye='text/css' media='print' />

    <!-- 캘린더 스크립트 -->
    <script src='lib/jquery/jquery.js'></script>
    <script src="lib/bootstrap/dist/js/bootstrap.js"></script>
    <script src='lib/moment/moment.min.js'></script>
    <script src='lib/fullcalendar/fullcalendar.js'></script>
    <script src="lib/fullcalendar/lang/ko.js"></script>
    <script src="lib/less/less.js" type="text/javascript"></script>
    
    <!--  파일 업로드  -->
    <link href="css/sh_file_upload.css" rel="stylesheet" type="text/css" />
    <script>
    (function(e,t,n){
        var r=e.querySelectorAll("html")[0];
        r.className=r.className.replace(/(^|\s)no-js(\s|$)/,"$1js$2")
    })
    (document,window,0);
    </script>

    <script src="lib/jquery-session-plugin/jquery.session.js" type="text/javascript"></script>
</head>

<body>
<header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="pet.html">THE PET</a>
      <div id="user_info"></div>
    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul>
          <li><a href="#"><i class="lnr lnr-pencil"></i> 교육</a></li>
          <li><a href="#"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="#"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="#"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="boastBoard.html"><i class="lnr lnr-paw"></i> 자랑해요</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
</header>

<section id="main-body">

    <div id="diary-pet-info">
        <div class="addSce">
            <button type="button" id="my-today-button" class="btn btn-default">Today</button>
            <a class="btn btn-default" id="petAdd" role="button" data-toggle="modal" data-target="#AddPet">Add Pet</a>
            <a class="btn btn-default" id="scheduleAdd" role="button" data-toggle="modal" data-target="#AddBoard">New</a>
        </div>
        
        <div id="myPets"></div>
    </div>

    <div id="calendar"></div>

</section>

<div id="fullCalModal" class="modal fade" data-keyboard="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">close</span>
                </button>
                <h4 id="modalTitle" class="modal-title"></h4>
            </div>

            <div class="modal-body">
                <span>시작일 : </span>
                <input type="date" id="mStart" class="form-control">
                <br>

                <span>종료일 : </span>
                <input type="date" id="mEnd" class="form-control">
                <br>

                <span>태그색 : </span>
                <input type="color" id="mColor">
                <br>
                <br>

                <span>내용 : </span>
                <br>

                <textarea id="mDes" class="form-control" rows="5"></textarea>
                <br>

                <span>이미지 : </span>
                <img src="" width="100%" height="auto">
                <br>

                <input type="file" id="mFile">
                <input type="hidden" value="p5.jpeg">
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-warning">변경</button>
                <button type="button" class="btn btn-danger">삭제</button>
            </div>
        </div>
    </div>
</div>

<!-- 펫 추가 모달 -->
<div class="modal fade" id="AddPet" role="dialog" data-keyboard="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h3 class="modal-title" id="lineModalLabel">펫 추가</h3>
            </div>

            <div class="modal-body">
                
                <form action="pet/ajax/add.do" method="post">
                    <input type="hidden" name="mno" class="myMno">
                    
                    <div class="form-group">
                        <label for="pName" class="col-sm-2 control-label">펫 이름</label>
                        <div class="col-sm-10">
                            <input type="text" name="pName" class="form-control" id="pName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pType" class="col-sm-2 control-label">펫 종류</label>
                        <div class="col-sm-10">
                            <input type="text" name="pType" placeholder="ex) 포메라니안" class="form-control" id="pType" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tagColor" class="col-sm-2 control-label">태그 색</label>
                        <div class="col-sm-10">
                            <input type="color" name="tagColor" class="form-control" id="tagColor" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="injection" class="col-sm-2 control-label">예방 접종 차수</label>
                        <div class="col-sm-10">
                            <input type="text" name="injection" class="form-control" id="injection" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="medicine" class="col-sm-2 control-label">심장 사상충 약 복용일</label>
                        <div class="col-sm-10">
                            <input type="text" name="medicine" class="form-control" id="medicine" required>
                        </div>
                    </div>
                    
                    <div class="box">
                        <input type="file" name="pImg" id="file-1" class="inputfile inputfile-1" />
                        <label for="file-1">
                            <i class="fa fa-upload"></i>
                            <span>펫 이미지</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button id='addBtn' type='submit' class="newForm btn btn-primary btn-xs">등록</button>
                        </div>
                    </div>
                    
                </form>
                
            </div>

        </div>
    </div>
</div>
<!-- //펫 추가 모달 -->

<!-- 게시글 추가 모달 -->
<div class="modal fade" id="AddBoard" role="dialog" data-keyboard="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h3 class="modal-title" id="lineModalLabel">글 추가</h3>
            </div>

            <div class="modal-body">

                <form action="diary/ajax/add.do" method="post" class="form-horizontal" novalidate>
                    <input type="hidden" name="mno"  class="myMno">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">전체공개</label>
                        <div class="switch">
                            <input type="checkbox" name="dhide" id="dhide" checked>
                            <label for="dhide">
                                <span class="fa fa-check"></span>
                                <span class="fa fa-times"></span>
                                <div></div>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cateCode" class="col-sm-2 control-label">카테고리</label>
                        <div class="col-sm-10">
                            <select id="cateCode" name="cateCode" class="form-control">
                                <option value="SANCHE" selected="selected">산책코스</option>
                                <option value="JARANG">자랑해요</option>
                                <option value="ILJUNG">펫 일정</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="pno" class="col-sm-2 control-label">펫 선택</label>
                        <div class="col-sm-10">
                            <select id="pno" name="pno" class="form-control" required>
                                <option value="">==펫 선택==</option>
                            </select>
                        </div>
                    </div>

                    <div class="pDate form-group">
                        <label class="col-sm-2 control-label">시작일</label>
                        <div class="col-sm-10">
                            <input type="date" name="startDate" id="startDate" class="form-control" required>
                        </div>
                    </div>

                    <div class="pDate form-group">
                        <label class="col-sm-2 control-label">종료일</label>
                        <div class="col-sm-10">
                            <input type="date" name="endDate" id="endDate" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ftitle" class="col-sm-2 control-label">제목</label>
                        <div class="col-sm-10">
                            <input type="text" name="title" class="form-control" id="title" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="fcontent" class="col-sm-2 control-label">내용</label>
                        <div class="col-sm-10">
                            <textarea id="fContent" name="content" class="form-control" rows='10' cols='60' required></textarea>
                        </div>
                    </div>

                    <div class="box">
                        <input type="file" name="fileName[]" id="file-1" class="inputfile inputfile-1" data-multiple-caption="{count}개의 파일이 선택되었습니다" multiple />
                        <label for="file-1">
                            <i class="fa fa-upload"></i>
                            <span>이미지 추가</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button id='addBtn' type='submit' class="newForm btn btn-primary btn-xs">등록</button>
                        </div>
                    </div>

                </form>

            </div>

        </div>
    </div>
</div>
<!-- //게시글 추가 모달 -->

<!-- 파일 업로드 파일 이름뜨는부분 -->
<script src="js/sh_custom-file-input.js"></script>

<!-- 캘린더 스크립트 -->
<script>
$(document).ready(function() {
//    로그인 회원 정보출력 세션없으면 로그인페이지로
    var div = $('#user_info');
    if ($.session.get('mno') != undefined) {
        div.append(
            "<img src='files/" + $.session.get('mimg') + "' id='userImg' />" +
            "<a id='userName' href='#'>" + $.session.get('mname') + "</a>" +
            "<a role='button' id='outBtn' class='logout'>" +
            "<i class='fa fa-unlock fa-lg'></i></a>")
    } else {
//        location.href = "login.html"
    }

//    로그아웃
    $(document).on("click", "#outBtn", function() {
        $.session.clear();
        location.href = "login.html"
    });

//    켈린더 출력
    function renderCalendar() {
        $('#calendar').fullCalendar({
            header: {
                left: 'prevYear',
                center: 'prev title next',
                right: 'nextYear',
            },
            theme: false, // false : 태마 적용 안함
            fixedWeekCount: false, // true 항상 6주로 표시, false 매 달에 따라 주의 수가 유동적
            weekNumbers: false, // 달력 맨앞에 그해의 몇주차인지 나오는거 false하면 안나옴
            editable: false, // false : 달력 내에 이밴트들 드래그로 이동 불가
            eventLimit: true, // allow "more" link when too many events
            events: function(start, end, timezone, callback) {
                $.ajax({
                    url: 'diary/ajax/events.do',
                    dataType: 'json',
                    data: {
                        mno: $.session.get('mno')
                    },
                    type: "get",
                    success: function(doc) {
                        var event = eval(doc.events);
                        callback(event);
                    }
                });
            },
            timeFormat: 'H:mm',
            eventClick: function(event, jsEvent, view) {
                if (event.end) {
                    $('#modalTitle').html(event.title);
                    $('#mStart').val(event.start.format().substring(0,10)); // 2015-12-31
                    $('#mEnd').val(event.end.format().substring(0,10));
                    $('#mColor').val(event.color);
                    $('#mDes').html(event.description);
                    $('#fullCalModal').modal();
                } else {
                    $('#modalTitle').html(event.title);
                    $('#mStart').val(event.start.format().substring(0,10));
                    $('#mEnd').val(event.end.format().substring(0,10));
                    $('#mColor').val(event.color);
                    $('#mDes').html(event.description);
                    $('#fullCalModal').modal();
                }
            }
        });
    }
    renderCalendar();
});

var no = $.session.get('mno');
$('.myMno').val(no);
if (no == undefined) {
    no = 0;
}

// 로그인한 회원의 펫 보여주는것
$.getJSON('pet/ajax/list.do?mno=' + no,
function(resultObj) {
    var showpet = $('#myPets');
    for (var pet of resultObj.pets) {
        showpet.append(
            "<div class='myPet'>" +
                "<img class='mImg' src='files/" + pet.pImg + "'>" +
                "<input class='petName' type='text' value='" + pet.pName + "' disabled>" +
                "<label class='pName'>이름 : </label>" +
                "<input class='pColor' type='color' value='" + pet.tagColor + "' disabled>" +
                "<label class='pInfo'>태그색 : </label>" +
            "</div>")
    }

    var sel = $("#pno");
    for (var pet of resultObj.pets) {
        sel.append("<option value='" + pet.pno + "'>" + pet.pName +
        "</option>")
    }
});

// 버튼으로 만들어서 누르면 현재 날짜로 이동한다.
$('#my-today-button').click(function() {
    $('#calendar').fullCalendar('today');
});

// 글쓰기 카테고리 선택 부분
$("select").change(function() {
    if ($('#cateCode').val() == "JARANG") { // 자랑 해요
        $('.pDate').css('display', 'none');
    }
}).change();
</script>

</body>

</html>
