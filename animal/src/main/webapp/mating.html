<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<link rel="icon" href="icon/1.ico" type="image/x-icon" />
<title>짝짓기</title>

<link href="lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet' type='text/css' />

<!--  내가만든 css들  -->
<link href="css/sh_slidmenu_header_mating.less" type="style.less" rel="stylesheet/less" />
<link href="css/sh_mating.css" type="text/css" rel="stylesheet">
<!--<link href="css/sh_file_upload.css" type="text/css" rel='stylesheet' />-->
<link href="css/CSSreset.min.css" type="text/css"	rel="stylesheet" />

<!--  폰트아이콘 링크  -->
<link href="lib/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />
<link href="css/icon-font.min.css" type="text/css" rel="stylesheet" />

<!-- 부트스트랩 -->
<script src='lib/jquery/jquery.min.js' type="text/javascript"></script>
<script src="lib/bootstrap/dist/js/bootstrap.js" type="text/javascript"></script>
<script src="lib/less/less.js" type="text/javascript"></script>

<script src="lib/jquery-session-plugin/jquery.session.js" type="text/javascript"></script>

<!-- filter 및 sort Test 중 -->
<script src="mixitup-master/build/jquery.mixitup.min.js" type="text/javascript"></script>

<script src="js/sh_custom-file-input.js"></script>

<!--  파일 업로드  -->
<!--<link href="css/sh_file_upload.css" rel="stylesheet" type="text/css" />-->
<script>
  (function(e, t, n) {
    var r = e.querySelectorAll("html")[0];
    r.className = r.className.replace(/(^|\s)no-js(\s|$)/, "$1js$2")
  })
  (document, window, 0);
</script>
  

<script>
$(function(){
    $('#Container').mixItUp();
});
</script>

<style>

button#All{
  display: inline-block;
  padding: .4em .8em;
  background: #fff;
  width: 50px;
  height: 30px;
  border: 0;
  color: #000;
  font-weight: 900;
  font-size: 16px;
  border-radius: 4px;
  cursor: pointer;
}

button#DOG{
  display: inline-block;
  padding: .4em .8em;
  background: #fff;
  width: 50px;
  height: 30px;
  border: 0;
  color: #ddd;
  font-size: 16px;
  font-weight: 300;
  border-radius: 4px;
  cursor: pointer;
  background-image: url(images/dog.png);
  background-size: cover;
}

button#CAT{
  display: inline-block;
  padding: .4em .8em;
  background: #fff;
  width: 50px;
  height: 30px;
  border: 0;
  color: #ddd;
  font-size: 16px;
  font-weight: 300;
  border-radius: 4px;
  cursor: pointer;
  background-image: url(images/cat.png);
  background-size: cover;
}

button#FISH{
  display: inline-block;
  padding: .4em .8em;
  background: #fff;
  width: 50px;
  height: 30px;
  border: 0;
  color: #ddd;
  font-size: 16px;
  font-weight: 300;
  border-radius: 4px;
  cursor: pointer;
  background-image: url(images/fish.png);
  background-size: cover;
  background-position: center;
}

button#BIRD{
  display: inline-block;
  padding: .4em .8em;
  background: #fff;
  width: 50px;
  height: 30px;
  border: 0;
  color: #ddd;
  font-size: 16px;
  font-weight: 300;
  border-radius: 4px;
  cursor: pointer;
  background-image: url(images/bird.png);
  background-size: 45px 35px;
  background-position: center;
}

button#ETC{
  display: inline-block;
  padding: 6px;
  background: #fff;
  width: 50px;
  height: 30px;
  border: 0;
  color: #000;
  font-weight: 900;
  font-size: 16px;
  border-radius: 4px;
  cursor: pointer;
}

button#All.active{
  background: #d06a79;
}

button#DOG.active{
  background: #d06a79;
  background-image: url(images/dog.png);
  background-size: cover;
}

button#CAT.active{
  background: #d06a79;
  background-image: url(images/cat.png);
  background-size: cover;   
}

button#FISH.active{
  background: #d06a79;
  background-image: url(images/fish.png);
  background-size: cover;
  background-position: center;
}

button#BIRD.active{
  background: #d06a79;
  background-image: url(images/bird.png);
  background-size: 45px 35px;
  background-position: center;
}

button#ETC.active{
  background: #d06a79;
}

button:focus{ /* 활성화 시 버튼 주변의 라인을 없애줌 */
  outline: 0 none;
}
</style>

</head>

<body>
  <header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="pet.html">
        <span id="the">THE</span> <span id="P">P</span><span id="et">ET</span>
      </a>
      <a class="headerSubTitle" href="mating.html">
        짝짓기
      </a>
      <div id="user_info"></div>
    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i
        class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul id="menu-nav-ul">
          <li><a href="Education/education.html"><i class="lnr lnr-pencil"></i> 교육</a></li>
          <li><a href="#"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="mating.html"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="walk.html"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="BoastBoard/boastBoard.html"><i class="lnr lnr-paw"></i>
              자랑해요</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
  </header>

  <section id="main-body">
    <!-- 위의 제목 부분 -->
      <button id="All" class="active" onclick="filter(this.id)">All</button>
      <button id="DOG" onclick="filter(this.id)"></button>
      <button id="CAT" onclick="filter(this.id)"></button>
      <button id="FISH" onclick="filter(this.id)"></button>
      <button id="BIRD" onclick="filter(this.id)"></button>
      <button id="ETC" onclick="filter(this.id)">ETC</button>
      <button id="hidden" hidden="">All</button>

      <button onclick="location.href='matingform.html'" id='addBtn' data-target='#addModal' data-toggle='modal'>새 글</button>
        <!--  Filter 영역 시작 -->


    <!-- 사진 게시물 영역 -->
    <div id='Container' class='container'></div>

    <div id="more">
      <a role="button" class="moreBtn" id="m2" onclick='moree(this.id);'>더보기</a>
    </div>

  </section>

<!-- 오류 모달 -->
<div id="noCom" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <i class="fa fa-exclamation-triangle"></i>
        에러!
      </div>
      
      <div class="modal-body">
        댓글을 입력해주세요
      </div>
      
      <div class="modal-footer">
        <button type="button" id="okok" class="btn btn-primary" data-dismiss="modal">확인</button>
      </div>
    </div>
  </div>
</div>

<!--짝짓기 디테일 모달-->
<div id='saleModal' class='modal fade' data-keyboard='false' data-backdrop='static'>
  <div class='modal-dialog'>
    <div class='modal-content'>
      <div class='modal-header'>
        <button id="closeBtn" type='button' class='close' data-dismiss='modal'>&times;</button>
        <h3 id='modalTitle' class='title'></h3>
      </div>

      <div class='modal-body'>

        <input type="hidden" id="mmatno">
        
        <div id='carousel-example-generic' class='carousel slide' data-ride='carousel' data-wrap='false' data-interval="false">
            <!-- Indicators -->
            <ol class='carousel-indicators' id="dots"></ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox" id="imgs"></div>

            <!-- Controls -->
            <a class='left carousel-control' href='#carousel-example-generic' role='button' data-slide='prev'>
                <span class='glyphicon glyphicon-chevron-left' aria-hidden='true'></span>
                <span class='sr-only'>Previous</span>
            </a>
            <a class='right carousel-control' href='#carousel-example-generic' role="button" data-slide='next'>
                <span class='glyphicon glyphicon-chevron-right' aria-hidden='true'></span>
                <span class='sr-only'>Next</span>
            </a>
        </div>

        <div class='contents'>

          <div class='content' id="mcontent">
            <textarea id="contentText" readonly></textarea>
          </div>

          <div class='input'>
            
            <div id="forms">
              <span class="gg">펫 종류</span>
              <input type="text" name="mat_gen" placeholder="ex) 포메라니안" id="mmtype" class="form-control">
            </div>
            
            <textarea id="comcontent" class='commentin' cols='30' rows='2' placeholder='댓글을 입력하세요...'></textarea>
            <a id="comDelBtn" role='button'>게시</a>
          </div>

          <div class='comments' id="comComment"></div>
          <div id="delImg"></div>
        </div>


      </div>

      <div class="modal-footer">

        <div class="box">
          <input type="file" name="files" id="file-1" class="inputfile inputfile-1" data-multiple-caption="{count}개의 파일이 선택되었습니다"
          multiple />
          <label for="file-1">
            <i class="fa fa-upload"></i>
            <span>이미지 추가</span>
          </label>
        </div>

        <button type="button" id="editPet" class="btn btn-warning">변경</button>
        <button type="button" id="editEnd" class="btn btn-warning" style="display:none;">변경완료</button>
        <button type="button" id="matDelBtn" class="btn btn-danger">삭제</button>
      </div>
    </div>

  </div>
</div>

<!-- 댓글 삭제 확인 모달 -->
<div id="checkModal" class="modal fade bs-example-modal-sm" data-keyboard='false' data-backdrop='static'>
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class='modal-header'>
        댓글 삭제
      </div>
      <div class='modal-body'>
        이 댓글을 삭제하시겠어요?
        <input type="hidden" id="comno">
      </div>
      <div class='modal-footer'>
        <button type="button" id="closeDel" class="btn btn-default" data-dismiss="modal">취소</button>
        <button type="button" id="delCom" class="btn btn-danger">삭제</button>
      </div>
    </div>
  </div>
</div>
<script src="js/sh_custom-file-input.js"></script>


<script>
function filter(id) { 
	   if(id == "All") {
		      $("#All").replaceWith("<button id='All' class='active' onclick='filter(this.id)'>All</button>");
		      $("#DOG").replaceWith("<button id='DOG' onclick='filter(this.id)'></button>");
		      $("#CAT").replaceWith("<button id='CAT' onclick='filter(this.id)'></button>");
		      $("#FISH").replaceWith("<button id='FISH' onclick='filter(this.id)'></button>");
		      $("#BIRD").replaceWith("<button id='BIRD' onclick='filter(this.id)'></button>");
		      $("#ETC").replaceWith("<button id='ETC' onclick='filter(this.id)'>ETC</button>");
		    }else if(id == "DOG") {
		        $("#All").replaceWith("<button id='All' onclick='filter(this.id)'>All</button>");
		        $("#DOG").replaceWith("<button id='DOG' class='active' onclick='filter(this.id)'></button>");
		        $("#CAT").replaceWith("<button id='CAT' onclick='filter(this.id)'></button>");
		        $("#FISH").replaceWith("<button id='FISH' onclick='filter(this.id)'></button>");
		        $("#BIRD").replaceWith("<button id='BIRD' onclick='filter(this.id)'></button>");
		        $("#ETC").replaceWith("<button id='ETC' onclick='filter(this.id)'>ETC</button>");
		    }else if(id == "CAT") {
		        $("#All").replaceWith("<button id='All' onclick='filter(this.id)'>All</button>");
		        $("#DOG").replaceWith("<button id='DOG' onclick='filter(this.id)'></button>");
		        $("#CAT").replaceWith("<button id='CAT' class='active'  onclick='filter(this.id)'></button>");
		        $("#FISH").replaceWith("<button id='FISH' onclick='filter(this.id)'></button>");
		        $("#BIRD").replaceWith("<button id='BIRD' onclick='filter(this.id)'></button>");
		        $("#ETC").replaceWith("<button id='ETC' onclick='filter(this.id)'>ETC</button>");
		    }else if(id == "FISH") {
		        $("#All").replaceWith("<button id='All' onclick='filter(this.id)'>All</button>");
		        $("#DOG").replaceWith("<button id='DOG' onclick='filter(this.id)'></button>");
		        $("#CAT").replaceWith("<button id='CAT' onclick='filter(this.id)'></button>");
		        $("#FISH").replaceWith("<button id='FISH' class='active'  onclick='filter(this.id)'></button>");
		        $("#BIRD").replaceWith("<button id='BIRD' onclick='filter(this.id)'></button>");
		        $("#ETC").replaceWith("<button id='ETC' onclick='filter(this.id)'>ETC</button>");
		    }else if(id == "BIRD") {
		        $("#All").replaceWith("<button id='All' onclick='filter(this.id)'>All</button>");
		        $("#DOG").replaceWith("<button id='DOG' onclick='filter(this.id)'></button>");
		        $("#CAT").replaceWith("<button id='CAT' onclick='filter(this.id)'></button>");
		        $("#FISH").replaceWith("<button id='FISH' onclick='filter(this.id)'></button>");
		        $("#BIRD").replaceWith("<button id='BIRD' class='active' onclick='filter(this.id)'></button>");
		        $("#ETC").replaceWith("<button id='ETC' onclick='filter(this.id)'>ETC</button>");
		    }else if(id ==  "ETC") {
		        $("#All").replaceWith("<button id='All' onclick='filter(this.id)'>All</button>");
		        $("#DOG").replaceWith("<button id='DOG' onclick='filter(this.id)'></button>");
		        $("#CAT").replaceWith("<button id='CAT' onclick='filter(this.id)'></button>");
		        $("#FISH").replaceWith("<button id='FISH' onclick='filter(this.id)'></button>");
		        $("#BIRD").replaceWith("<button id='BIRD' onclick='filter(this.id)'></button>");
		        $("#ETC").replaceWith("<button id='ETC' class='active' onclick='filter(this.id)'>ETC</button>");
		    }
	   
	   $('#Container').empty();
	      var currentPage = 1;
	      var totalCount = 0;
	      
	      var filter_data = new FormData();
	      filter_data.append("filter_id", id);
	      
	      
	      $.ajax({
	          url : "mating/ajax/filterCount.do",
	          dataType : 'json',
	          contentType : false,
	          processData : false,
	          data : filter_data,
	          async : false,
	          type : 'POST',
	          success : function(resultObj) {
	        	  totalCount =  resultObj.count;	        	  
	          }
	        })
	        
	        $('#more').empty();
	      if(totalCount > 1){
	    	  $('#more').append("<a role='button' class='moreBtn' id='filterBtn'>더보기</a>");
	   }

	      $.ajax({
	          url : "mating/ajax/filter_list.do?pageNo="+currentPage,
	          dataType : "json",
	          type : "POST",
	          contentType : false,
	          processData : false,
	          data : filter_data,
	          async : false,
	          success : function(resultObj) {
	        	  
	        	  alert(resultObj);
	        	  
/* 	        	  var show = $('#Container');
	              var gen;
	              var imgWidth;
	              var imgHeight;
	              var setClass;
	              
	                  if(mating.matGender == 0) {
	                      gen = "수컷";
	                  } else {
	                      gen = "암컷";
	                  }
	                  imgWidth = file[0].width;

	                  imgHeight = file[0].height;

	                  if (imgWidth > imgHeight) {
	                    setClass = "landscape"
	                  } else {
	                    setClass = "portrait"
	                  }
	                  j++;
	                  show.append("<div class='portfoliocard mix " + mating.matSpec + "' role='button' " +
	                  "data-target='#saleModal' data-toggle='modal' id='" + mating.matNo +
	                  "' onclick='detail(this.id);'>" +

	                  "<div class='coverphoto'><img src='files/" + file[0].fileName + "' class='" + setClass + "'></div>" +

	                  "<div class='profile_picture'><img src='files/" + mem.mImg + "'></div>" +

	                  "<div class='left_col'>" +
	                  "<div class='views'>" +
	                  "<div class='view_count' id='v" + mating.matNo + "'>" + mating.matViews + "</div>" +
	                  "VIEW" +
	                  "</div>" +
	                  "</div>" +

	                  "<div class='right_col'>" +
	                  "<ul class='contact_information'>" +
	                  "<li class='website'>" + mating.matSpec + "</li>" +
	                  "<li class='website'>" + mating.matType + "</li>" +
	                  "<li class='gender'>" + gen + "</li>" +
	                  "<li class='title'>" + mating.matTitle + "</li>" +
	                  "<li class='resume'>" + mating.matCreateDate + "</li>" +
	                  "<li class='name'>" + mem.mName + "</li>" +
	                  "</ul>" +
	                  "</div>" +
	                  "</div>") */
	        	  
	          }
	      })
}
</script>

<script>
$(document).ready(function() {
  $('#delImg').css('display', 'none');
  $('.box').css('display', 'none');
  $('#forms').css('display', 'none');
  
  // 로그인 회원 정보출력 세션없으면 로그인페이지로
  var no = $.session.get('mno');
  var div = $('#user_info');
  var ul = $('#menu-nav-ul');
  if (no == undefined) {
    div.append("<a href='login.html' id='loginBtn'>로그인</a>")
  } else {
    $('#myMno1').val(no);
    $('#myMno2').val(no);

    div.append(
      "<a role='button' id='msgBtn' class='Msg' href='messagebox.html'>" +
        "<i class='fa fa-envelope-o'></i>" +
        "<span class='badge' id='userBadge'>0</span>" +
      "</a>" +
      "<img src='files/" + $.session.get('mimg') + "' id='userImg' />" +
      "<a id='userName' href='#'>" + $.session.get('mname') + "</a>" +
      "<a role='button' id='outBtn' class='logout'>" +
        "<i class='fa fa-unlock fa-lg'></i>" +
      "</a>")
    ul.append(
      "<li><a href='diary.html'><i class='lnr lnr-book'></i> 다이어리</a></li>")
  }

  // 로그아웃
  $(document).on("click", "#outBtn", function() {
        $.session.clear();
        location.href = "login.html"
    });

  // 안읽은 받은쪽지 갯수 출력
  var no = $.session.get('mno');
  var form_data = new FormData();
  form_data.append("recvMno", no)
  $.ajax({
    url: 'message/ajax/noReadMsg.do',
    type: 'post',
  //    async: false,
    dataType: 'json',
    cache: false,
    contentType: false,
    processData: false,
    data: form_data,
    success: function(resultObj) {
      var ajaxResult = resultObj.ajaxResult;
      $('#userBadge').html(ajaxResult.data.noReadCount)
    }
  })
  
  $.getJSON('mating/ajax/pages.do', function(resultObj) {
    var ajaxResult = resultObj.ajaxResult;
    if(ajaxResult.data == 1) {
      $('#more').empty();
    } 
  })
});

// 분양 리스트 출력
$.ajax({
    url: 'mating/ajax/list.do',
    async: false,
    type: 'post',
    dataType: 'json',
    success: function(resultObj) {
        var show = $('#Container');
        var j = 0;
        var file;
        var mem;
        var gen;
        var imgWidth;
        var imgHeight;
        var setClass;
        for (var mating of resultObj.mating) {
            file = resultObj.filesMap[j];
            mem = resultObj.memberMap[j];
            if(mating.matGender == 0) {
                gen = "수컷";
            } else {
                gen = "암컷";
            }
            imgWidth = file[0].width;

            imgHeight = file[0].height;

            if (imgWidth > imgHeight) {
              setClass = "landscape"
            } else {
              setClass = "portrait"
            }
            j++;
            show.append("<div class='portfoliocard mix " + mating.matSpec + "' role='button' " +
            "data-target='#saleModal' data-toggle='modal' id='" + mating.matNo +
            "' onclick='detail(this.id);'>" +

            "<div class='coverphoto'><img src='files/" + file[0].fileName + "' class='" + setClass + "'></div>" +

            "<div class='profile_picture'><img src='files/" + mem.mImg + "'></div>" +

            "<div class='left_col'>" +
            "<div class='views'>" +
            "<div class='view_count' id='v" + mating.matNo + "'>" + mating.matViews + "</div>" +
            "VIEW" +
            "</div>" +
            "</div>" +

            "<div class='right_col'>" +
            "<ul class='contact_information'>" +
            "<li class='website'>" + mating.matSpec + "</li>" +
            "<li class='website'>" + mating.matType + "</li>" +
            "<li class='gender'>" + gen + "</li>" +
            "<li class='title'>" + mating.matTitle + "</li>" +
            "<li class='resume'>" + mating.matCreateDate + "</li>" +
            "<li class='name'>" + mem.mName + "</li>" +
            "</ul>" +
            "</div>" +
            "</div>")
        }
    }
});



// 짝짓기 디테일
function detail(id) {
  var view = $("#v" + id);
  var form_data = new FormData();
  form_data.append("matNo", id)
  $.ajax({
    url: "mating/ajax/detail.do",
    dataType: 'json',
    cache: false,
    contentType: false,
    processData: false,
    data: form_data,
    type: 'post',
    success: function(re) {
      var matinfo = re.ajaxResult.data;
      $('#modalTitle').html(matinfo.matTitle);
      $('#contentText').val(matinfo.matContent);
      $('#mmatno').val(matinfo.matNo);
      $('#mmtype').val(matinfo.matType);
      
      var form_data = new FormData();
      form_data.append("matNo", id)
      $.ajax({
        url: "files/ajax/matlist.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          var files = re.ajaxResult.data;
          
          var imgs = $('#imgs');
          var dots = $('#dots');
          var showDel = $('#delImg');
          var i = 0;
          for (var file of files) {
            if (i == 0) {
              imgs.append(
              "<div class='item active'>" +
                "<img class='slideimg' src='files/" + file.fileName + "'>" +
              "</div>")
              dots.append(
              "<li data-target='#carousel-example-generic' data-slide-to='" + i +
              "' class='active'></li>")
              if (files.length == 1) {
                showDel.append("<img src='files/" + file.fileName + "'>")
              } else {
                showDel.append(
                "<img src='files/" + file.fileName + "'>" +
                "<a role='button' id='" + file.fno + "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>")
              }
            } else {
              imgs.append(
              "<div class='item'>" +
                "<img class='slideimg' src='files/" + file.fileName + "'>" +
              "</div>")
              dots.append(
              "<li data-target='#carousel-example-generic' data-slide-to='" + i +
              "'></li>")
              if (files.length == 1) {
                showDel.append("<img src='files/" + file.fileName + "'>")
              } else {
                showDel.append(
                "<img src='files/" + file.fileName + "'>" +
                "<a role='button' id='" + file.fno + "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>")
              }
            }
            i++;
          }
          var form_data = new FormData();
          form_data.append("matNo", id)
          $.ajax({
            url: "comment/ajax/matcomlist.do",
            dataType: 'json',
            cache: false,
            contentType: false,
            processData: false,
            data: form_data,
            type: 'post',
            success: function(re) {
              var commen = re.comments;
              var comdiv = $('#comComment');
              var mem;
              var j = 0;
              for (var com of commen) {
                mem = re.memberMap[j];
                if($.session.get('mno') == mem.mno) {
                  comdiv.append(
                  "<div class='comment'>" +
                    "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                    "<div class='commentname'>" + mem.mName + "</div>" +
                    "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
                    "<i class='fa fa-close'></i></a>" +
                    "<div class='commenttext'>" + com.comComment + "</div>" +
                  "</div>")
                } else {
                  comdiv.append(
                  "<div class='comment'>" +
                    "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                    "<div class='commentname'>" + mem.mName + "</div>" +
                    "<div class='commenttext'>" + com.comComment + "</div>" +
                  "</div>")
                }
                    j++;
              }
            }
          })
        }
      })
    },
    complete: function() {
      $.ajax({
          url: 'mating/ajax/views.do',
          data: {
              "matNo": id
          },
          async: false,
          dataType: 'json',
          type: "post",
          success: function(re) {
            console.log()
            console.log(re.ajaxResult.data.matViews)
            view.html(re.ajaxResult.data.matViews)
          }
      })
    }
  })

}

// 펫 디테일 -> 댓글게시 클릭
$(document).on("click", "#comDelBtn", function() {
  if ($('#comcontent').val() == "") {
    
    $('#noCom').modal('show');
    return false;
    
  } else {
    var form_data = new FormData();
    form_data.append("matNo", $('#mmatno').val())
    form_data.append("comComment", $('#comcontent').val())
    form_data.append("mno", $.session.get('mno'))
    $.ajax({
      url: "comment/ajax/add.do",
      dataType: 'json',
      cache: false,
      contentType: false,
      processData: false,
      data: form_data,
      type: 'post',
      success: function(re) {
        $('#comcontent').val('')
        var form_data = new FormData();
        form_data.append("matNo", $('#mmatno').val())
        $.ajax({
          url: "comment/ajax/matcomlist.do",
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: 'post',
          success: function(re) {
            $('#comComment').empty();
            var commen = re.comments;
            var comdiv = $('#comComment');
            var mem;
            var j = 0;
            for (var com of commen) {
              mem = re.memberMap[j];
              if($.session.get('mno') == mem.mno) {
                comdiv.append(
                "<div class='comment'>" +
                  "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                  "<div class='commentname'>" + mem.mName + "</div>" +
                  "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
                  "<i class='fa fa-close'></i></a>" +
                  "<div class='commenttext'>" + com.comComment + "</div>" +
                "</div>")
              } else {
                comdiv.append(
                "<div class='comment'>" +
                  "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                  "<div class='commentname'>" + mem.mName + "</div>" +
                  "<div class='commenttext'>" + com.comComment + "</div>" +
                "</div>")
              }
              j++;
            }
          }
        })
      }
    })
  }
})

//댓글 삭제 도우미
function del(id) {
  $('#comno').val(id)
  $('#checkModal').modal('show')
}

// 댓글 삭제
$(document).on("click", "#delCom", function() {
  var form_data = new FormData();
  console.log($('#comno').val())
  form_data.append("comNo", $('#comno').val())
  $.ajax({
    url: "comment/ajax/delete.do",
    dataType: 'json',
    cache: false,
    contentType: false,
    processData: false,
    data: form_data,
    type: 'post',
    success: function(re) {
      $('#checkModal').modal('hide')
      var form_data = new FormData();
      form_data.append("matNo", $('#mmatno').val())
      $.ajax({
        url: "comment/ajax/matcomlist.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          $('#comComment').empty();
          var commen = re.comments;
          var comdiv = $('#comComment');
          var mem;
          var j = 0;
          for (var com of commen) {
            mem = re.memberMap[j];
            comdiv.append(
            "<div class='comment'>" +
              "<img class='commentimg' src='files/" + mem.mImg + "'>" +
              "<div class='commentname'>" + mem.mName + "</div>" +
              "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
              "<i class='fa fa-close'></i></a>" +
              "<div class='commenttext'>" + com.comComment + "</div>" +
            "</div>")
            j++;
          }
        }
      })
    }
  })
})

// 새글 모달 닫고 초기화
$('#saleModal').on('hidden.bs.modal', function(e) {
  $('#mafile').val('');
  $('#mat_content').val('');
  $('#mat_title').val('');
  $('#mat_type').val('');
})

// 디테일 모달 닫고 초기화
$('#saleModal').on('hidden.bs.modal', function(e) {
  $('#comComment').empty();
  $('#dots').empty();
  $('#imgs').empty();
  $('#delImg').empty();
  $('#modalTitle').val('');
  $('#mcontent').val('');
  $('#mmatno').val('');
  $('#file-1').val('');
  
  $("textarea[id=contentText]").attr("readonly",true);
  $("textarea[class=commentin]").attr("readonly",false);
  $('.box').css('display', 'none');
  $('.commentin').css('display', '');
  $('#comDelBtn').css('display', '');
  $('#forms').css('display', 'none');
  $("button[id=comDelBtn]").attr("disabled",false);
  $('#editPet').css('display', '');
  $('#editEnd').css('display', 'none');
  $('.comments').css('display', '');
  $('#delImg').css('display', 'none');
  $('#contentText').css('background-color', '#2d335e');
  $('#contentText').css('color', '#fff');
})

// 짝짓기 삭제
$(document).on('click', '#matDelBtn', function() {
    $.ajax({
        url: 'mating/ajax/delete.do',
        dataType: 'json',
        type: 'get',
        data: {
            "matNo": $('#mmatno').val()
        },
        success: function (ro) {
            console.log(ro)
            location.href='mating.html';
        }
    })
});

// 디테일 변경 누르면 발생
$(document).on("click", "#editPet", function() {
  $("textarea[id=contentText]").attr("readonly",false);
  $("textarea[class=commentin]").attr("readonly",true);
  $('.box').css('display', '');
  $('.commentin').css('display', 'none');
  $('#comDelBtn').css('display', 'none');
  $('#forms').css('display', '');
  $("button[id=comDelBtn]").attr("disabled",true);
  $('#editPet').css('display', 'none');
  $('#editEnd').css('display', '');
  $('.comments').css('display', 'none');
  $('#delImg').css('display', '');
  $('#contentText').css('background-color', '#ffffff');
  $('#contentText').css('color', '#2d335e');
})

// 디테일 변경완료 누르면 발생
$(document).on("click", "#editEnd", function() {
  $("textarea[id=contentText]").attr("readonly",true);
  $("textarea[class=commentin]").attr("readonly",false);
  $('.box').css('display', 'none');
  $('.commentin').css('display', '');
  $('#comDelBtn').css('display', '');
  $('#forms').css('display', 'none');
  $("button[id=comDelBtn]").attr("disabled",false);
  $('#editPet').css('display', '');
  $('#editEnd').css('display', 'none');
  $('.comments').css('display', '');
  $('#delImg').css('display', 'none');
  $('#contentText').css('background-color', '#2d335e');
  $('#contentText').css('color', '#fff');
  
  var form_data = new FormData();
  form_data.append("matNo", $('#mmatno').val())
  form_data.append("matContent", $('#contentText').val())
  form_data.append("matType", $('#mmtype').val())
  $.ajax({
    url: "mating/ajax/update.do",
    dataType: 'json',
    cache: false,
    async: false,
    contentType: false,
    processData: false,
    data: form_data,
    type: 'post',
    success: function(re) {
      console.log("디테일 변경 성공")
      for (var i = 0; i < $("#file-1").prop("files").length; i++) {
        var file_data = $("#file-1").prop("files")[i];
        var file_name = file_data.name;
        var form_data = new FormData();
        form_data.append("file", file_data)
        form_data.append("fName", file_name)
        form_data.append("matNo", $('#mmatno').val())
        $.ajax({
          url: "files/ajax/matUpload.do",
          dataType: 'json',
          cache: false,
          async: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: 'post',
          success: function(resultObj) {
              console.log(file_name)
              
          }
        })
      }
      location.href='mating.html';
    }
  })
})

// 디테일 모달 속 이미지 하나하나 지우기
function imgDel(id) {
  console.log("fno : " + id)
  var form_data = new FormData();
  form_data.append("fno", id)
  $.ajax({
    url: "files/ajax/delOneImg.do",
    dataType: 'json',
    cache: false,
    contentType: false,
    processData: false,
    data: form_data,
    type: 'post',
    success: function(re) {
      console.log("이미지 삭제 성공")

      var form_data = new FormData();
      form_data.append("matNo", $('#mmatno').val())
      console.log("matNo : " + $('#mmatno').val())
      $.ajax({
        url: "files/ajax/matlist.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          var files = re.ajaxResult.data;
          console.log(files);
          $('#imgs').empty();
          $('#dots').empty();
          $('#delImg').empty();
          var imgs = $('#imgs');
          var dots = $('#dots');
          var showDel = $('#delImg');
          var i = 0;
          for (var file of files) {
            if (i == 0) {
              imgs.append(
              "<div class='item active'>" +
                "<img class='slideimg' src='files/" + file.fileName + "'>" +
              "</div>")
              dots.append(
              "<li data-target='#carousel-example-generic' data-slide-to='" + i +
              "' class='active'></li>")
              if (files.length == 1) {
                showDel.append("<img src='files/" + file.fileName + "'>")
              } else {
                showDel.append(
                "<img src='files/" + file.fileName + "'>" +
                "<a role='button' id='" + file.fno + "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>")
              }
              
            } else {
              imgs.append(
              "<div class='item'>" +
                "<img class='slideimg' src='files/" + file.fileName + "'>" +
              "</div>")
              dots.append(
              "<li data-target='#carousel-example-generic' data-slide-to='" + i +
              "'></li>")
              if (files.length == 1) {
                showDel.append("<img src='files/" + file.fileName + "'>")
              } else {
                showDel.append(
                "<img src='files/" + file.fileName + "'>" +
                "<a role='button' id='" + file.fno + "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>")
              }
            }
            i++;
          }
        }
      })
    }
  });
}

//더보기
function moree(id) {
  console.log(id)
  var page = id.substring(1);
  $.ajax({
    url: 'mating/ajax/list.do?',
    data: {
      pageNo: page
    },
    type: 'post',
    dataType: 'json',
    success: function(resultObj) {
      var show = $('#Container');
      var j = 0;
      var file;
      var mem;
      var gen;
      var imgWidth;
      var imgHeight;
      var setClass;
      for (var mating of resultObj.mating) {
        file = resultObj.filesMap[j];
        mem = resultObj.memberMap[j];
        
        if(mating.matGender == 0) {
          gen = "수컷";
        } else {
          gen = "암컷";
        }
        
        imgWidth = file[0].width;
        imgHeight = file[0].height;

        if (imgWidth > imgHeight) {
          setClass = "landscape"
        } else {
          setClass = "portrait"
        }
        j++;
        
        show.append("<div class='portfoliocard mix " + mating.matSpec + "' role='button' " +
        "data-target='#saleModal' data-toggle='modal' id='" + mating.matNo +
        "' onclick='detail(this.id);'>" +

        "<div class='coverphoto'><img src='files/" + file[0].fileName + "' class='" + setClass + "'></div>" +

        "<div class='profile_picture'><img src='files/" + mem.mImg + "'></div>" +

        "<div class='left_col'>" +
        "<div class='views'>" +
        "<div class='view_count' id='v" + mating.matNo + "'>" + mating.matViews + "</div>" +
        "VIEW" +
        "</div>" +
        "</div>" +

        "<div class='right_col'>" +
        "<ul class='contact_information'>" +
        "<li class='website'>" + mating.matSpec + "</li>" +
        "<li class='website'>" + mating.matType + "</li>" +
        "<li class='gender'>" + gen + "</li>" +
        "<li class='title'>" + mating.matTitle + "</li>" +
        "<li class='resume'>" + mating.matCreateDate + "</li>" +
        "<li class='name'>" + mem.mName + "</li>" +
        "</ul>" +
        "</div>" +
        "</div>")
      }

      $.getJSON('mating/ajax/pages.do', function(resultObj) {
        var ajaxResult = resultObj.ajaxResult;
        console.log(ajaxResult.data)
        if (ajaxResult.data == page) {
          console.log("더보기 끝")
          $('#more').empty();

        } else {
          console.log("더보기 생성")
          var more = $('#more');
          $('#more').empty();
          var i = parseInt(page)+1;
          more.append(
            "<a role='button' class='moreBtn' id='m" + i + "' onclick='moree(this.id);'>더보기</a>")
        }
      })
    }

  })
}

</script>

</body>

</html>
