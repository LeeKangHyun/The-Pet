<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<link rel="icon" href="../icon/1.ico" type="image/x-icon" />
<title>The Pet - 자랑하기</title>

<link href="../lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet'
	type='text/css' />

<!--  내가만든 css들  -->
<link href="../css/sh_slidmenu_header_diary.css" rel="stylesheet" />

<!--  폰트아이콘 링크  -->
<link href="../lib/font-awesome/css/font-awesome.min.css"	rel="stylesheet" />
<link href="../css/icon-font.min.css" rel="stylesheet" />

<!-- 지호가 만든 BoastDetail Css -->
<link href="../css/jh_detail.css" type="stylesheet" rel="stylesheet" />

<!-- 부트스트랩 -->
<script src='../lib/jquery/jquery.js'></script>
<script src="../lib/bootstrap/dist/js/bootstrap.js"></script>

<script src="../lib/jquery-session-plugin/jquery.session.js"
	type="text/javascript"></script>

<!-- Image Slide get Start Script -->
<script>
  $(document).ready(function() {
    $('.carousel').carousel({
      interval: 3000,
      pause: "hover",
      wrap: true,
      keyboard: true
    });
  });
  </script>

<style>
#share {
position: relative;
display: inline;
float: right;
margin-right: 10px;
top: 12px;
}
</style>

</head>

<body>
	<header id="menu">
		<div id="header_title">
			<a class="headerTitle" href="../pet.html"> <span id="the">THE</span>
				<span id="P">P</span><span id="et">ET</span>
			</a> <a class="headerSubTitle" href="boastBoard.html"> 자랑해요 </a>
			<div id="user_info"></div>
		</div>
		<!--  메뉴 버튼  -->
		<input type="checkbox" id="menuToggle" />

		<div id="sideMenu">
			<label for="menuToggle" id="menu-icon"><i
				class="fa fa-bars fa-lg"></i></label>
			<!--  메뉴 내용  -->

			<nav id="menu-nav">
				<ul id="menu-nav-ul">
					<li><a href="../Education/education.html"><i
							class="lnr lnr-pencil"></i> 교육</a></li>
					<li><a href="../sale.html"><i class="lnr lnr-store"></i> 분양</a></li>
					<li><a href="../mating.html"><i class="lnr lnr-heart"></i>
							짝짓기</a></li>
					<li><a href="../walk.html"><i class="lnr lnr-leaf"></i>
							산책코스</a></li>
					<li><a href="boastBoard.html"><i class="lnr lnr-paw"></i>
							자랑해요</a></li>
				</ul>
			</nav>
			<!--  //메뉴 내용  -->
		</div>
	</header>



	<!-- 내용 시작 -->
	<section id="main-body">

		<!-- image Slide Section -->
		<div id="carousel-example-generic" class="carousel slide"
			data-ride="carousel">
			<!-- Indicators -->
			<ol class="carousel-indicators">

			</ol>

			<!-- Wrapper for slides -->
			<div id="img-container">
				<div class="carousel-inner" id="img-container-inner" role="listbox">

				</div>
			</div>


			<!-- Controls -->
			<a class="left carousel-control" id="left-control"
				href="#carousel-example-generic" role="button" data-slide="prev">

			</a> <a class="right carousel-control" id="right-control"
				href="#carousel-example-generic" role="button" data-slide="next">

			</a>

		</div>
		<!-- Image Slide Section End -->

		<!-- content top(제목, 작성자, 날짜, 조회수, 좋아요) -->
		<div id="title"></div>

		<div id="title-section">
			<div id="writer"></div>
			<div id="likes"></div>
			<div id="cre_dt"></div>
			<div id="views"></div>
		</div>
		<!-- content top(제목, 작성자, 날짜, 조회수, 좋아요) 끝 -->
		<!-- content top(제목, 작성자, 날짜, 조회수, 좋아요) 끝 -->


		<!-- 자랑하기 내용 Section -->
		<div id="content-content"></div>

		<div id="btn-Section">
			<div id="list">
				<button type="button" class="btn btn-success" id="list-Btn">목록</button>
			</div>
			<div id="delete"></div>
			<div id="share"><a name="fb_share" type="button_count" onclick="sharing();">공유하기</a></div>
			<a id="comment-list" onclick='comment()'><span>댓글</span> <span id="comment-list-num"></span>
				<i class="fa fa-angle-up"></i></a>
		</div>
		<!-- 자랑하기 내용 Section End -->

		<!-- 댓글 입력부분 -->
<div class='input'>

		</div>


		<!-- 댓글과 버튼을 포함한 구역 -->
		<div class='comments' id="comComment">
			<!-- 댓글 구역 -->
			<div id="commentSection"></div>
		</div>
		<!-- 댓글 더보기 버튼 -->
		<!-- 댓글과 버튼을 포함한 구역 끝 -->

		<div id="comment-more">

   </div>

	</section>


<!-- Delete Check Modal -->
<div class="modal fade" id="Delete-Check-Modal" tabindex="-1"
  role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"
          aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">게시물 삭제</h4>
      </div>
      <div class="modal-body">이 게시글을 삭제하시겠어요?</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" id="delete-no"
          data-dismiss="modal">취소</button>
        <button type="button" class="btn btn-danger" id="delete-yes">삭제</button>
      </div>
    </div>
  </div>
</div>


<!-- Comment Delete Check Modal -->
<div class="modal fade" id="Comment-Delete-Check-Modal" tabindex="-1"
  role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"
          aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">댓글 삭제</h4>
      </div>
      <div class="modal-body">이 댓글을 삭제하시겠어요?</div>
      <input type="hidden" id="comno">
      <div class="modal-footer">
        <button type="button" class="btn btn-default"
          id="comment-delete-no" data-dismiss="modal">취소</button>
        <button type="button" class="btn btn-danger"
          id="comment-delete-yes">삭제</button>
      </div>
    </div>
  </div>
</div>

<!-- 알림 모달 -->
<div id="modo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <i class="fa fa-info"></i>
        알림
      </div>

      <div class="modal-body">
        <span id="modoinfo"></span>
      </div>

      <div class="modal-footer">
        <button type="button" id="okok" class="btn btn-primary" data-dismiss="modal">확인</button>
      </div>
    </div>
  </div>
</div>


<script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript">
</script>

	<!-- 댓글 펼치기 -->
<script>
var toggle = 0;

var totalPage = 0;
var currentPage = 1;

var url = location.href;
var dno = url.split('?')[1].split('=')[1];
var like_toggle = 0;

var detail_data = new FormData();
detail_data.append("dno", dno);

function comment() {

  if (toggle == 0) {
    // 댓글 입력 창 생성
    $('.input').append("<div id='input'>"+
      "</div>"+
        "<form>"+
          "<textarea id='comcontent' class='commentin' cols='30' rows='2'"+
            "placeholder='댓글을 입력하세요...'></textarea>"+
          "<a id='comAddBtn' role='button' onclick='detailBoastBoard()'>게시</a>"+
          "<button type='reset' id='reset' hidden=''/>"+
        "</form>");
    //댓글 입력 창 이미지 생성
    if ($.session.get('mname') != undefined) {
      $('#input').append("<img id='comimg' src='../files/"+$.session.get('mimg')+"'>");
    } else {
      $('#input').append("<img id='comimg' src='../files/default.jpg'>");
    }


    $.ajax({
      url : "../boastboard/ajax/detail_content.do?pageNo="+currentPage,
      dataType : "json",
      type : "POST",
      contentType : false,
      processData : false,
      async: "true",
      data : detail_data,
      success : function(resultObj) {
        $("#comment-list").replaceWith("<a id='comment-list' onclick='comment()'><span>댓글</span> <span id='comment-list-num'> <span>"+resultObj.count+"</span> </span><i class='fa fa-angle-down'></i></a>");
        toggle = 1;

        totalPage = resultObj.totalPage;
        if (totalPage > 1) {
         $("#comment-more").append("<div id='more'><a role='button' class='moreBtn' id='moreBtn' onclick='more()'>댓글 더보기</a></div>");
        }

        for (var i = 0; i < resultObj.comment.length; i++) {
          if ($.session.get('mno') == resultObj.comment[i].mno) {
            $('#commentSection').append(
            "<div class='comment'>"+
            "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>"+
            "<div class='commentname'>" + resultObj.comment[i].mName + "</div>"+
            "<a id='"+resultObj.comment[i].comNo+"' class='comment-delete' onclick='del(this.id)'>"+
            "<i class='fa fa-times' id='comment-delete' data-toggle='modal' data-target='#Comment-Delete-Check-Modal'></i>"+
            "</a>"+
            "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>"+
            "</div>");
          } else {
            $('#commentSection').append(
            "<div class='comment'>"+
              "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>"+
              "<div class='commentname'>" + resultObj.comment[i].mName + "</div>"+
              "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>"+
            "</div>");
          }
        }
      }
    });
  }

  else if (toggle == 1) {
    $.ajax({
      url : "../boastboard/ajax/detail_content.do",
      dataType : "json",
      type : "POST",
      contentType : false,
      processData : false,
      async: "true",
      data : detail_data,
      success : function(resultObj) {
        $("#comment-list").replaceWith("<a id='comment-list' onclick='comment()'><span>댓글</span> <span id='comment-list-num'> <span>"+resultObj.count+"</span> </span><i class='fa fa-angle-up'></i></a>");
        toggle = 0;
        $('.input').empty();
        $('#commentSection').empty();
        $('#comment-more').empty();
      }
    })
  }
};


function more() {

	currentPage = currentPage + 1;

	$.ajax({
    url : "../boastboard/ajax/detail_content.do?pageNo="+currentPage,
    dataType : "json",
    type : "POST",
    contentType : false,
    processData : false,
    async: "true",
    data : detail_data,
    success : function(resultObj) {
      for (var i = 0; i < resultObj.comment.length; i++) {
        if ($.session.get('mno') == resultObj.comment[i].mno) {
          $('#commentSection').append(
          "<div class='comment'>"+
          "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>"+
          "<div class='commentname'>" + resultObj.comment[i].mName + "</div>"+
          "<a id='"+resultObj.comment[i].comNo+"' class='comment-delete' onclick='del(this.id)'>"+
          "<i class='fa fa-times' id='comment-delete' data-toggle='modal' data-target='#Comment-Delete-Check-Modal'></i>"+
          "</a>"+
          "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>"+
          "</div>");
        } else {
          $('#commentSection').append(
          "<div class='comment'>"+
          "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>"+
          "<div class='commentname'>" + resultObj.comment[i].mName + "</div>"+
          "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>"+
          "</div>");
        }
      }
    }
	});

	if(currentPage >= totalPage) {
		$("#more").empty();
	}
}
</script>

	<!-- 댓글 입력 시 댓글 생성 -->
<script>
function detailBoastBoard() {
  var url = location.href;
  var dno = url.split('?')[1].split('=')[1];

  var mno = $.session.get('mno');
  var content = $('#comcontent').val();

  var comment_data = new FormData();
  comment_data.append("dno", dno);
  comment_data.append("mno", mno);
  comment_data.append("content", content);

  $('#commentSection').empty();
  $("#reset").trigger("click");

  currentPage = 1;
  $("#comment-more").empty();

  $.ajax({
    url : "../boastboard/ajax/comment_add.do",
    dataType : "json",
    type : "POST",
    contentType : false,
    processData : false,
    async: false,
    data : comment_data,
    success : function(resultObj) {

    	totalPage = resultObj.totalPage;
        if (totalPage > 1) {
         $("#comment-more").append("<div id='more'><a role='button' class='moreBtn' id='moreBtn' onclick='more()'>댓글 더보기</a></div>");
        }

      $("#comment-list").replaceWith("<a id='comment-list' onclick='comment()'><span>댓글</span> <span id='comment-list-num'> <span>"+resultObj.count+"</span> </span><i class='fa fa-angle-down'></i></a>");
      for (var i = 0; i < resultObj.comment.length; i++) {
        if ($.session.get('mno') == resultObj.comment[i].mno) {
          $('#commentSection').append(
          "<div class='comment'>" +
          "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>" +
          "<div class='commentname'>" + resultObj.comment[i].mName + "</div>" +
          "<a id='" + resultObj.comment[i].comNo + "' class='comment-delete' onclick='del(this.id)'>" +
          "<i class='fa fa-times' id='comment-delete' data-toggle='modal' data-target='#Comment-Delete-Check-Modal'></i>" +
          "</a>"+
          "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>" +
          "</div>");
        } else {
          $('#commentSection').append(
          "<div class='comment'>" +
          "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>" +
          "<div class='commentname'>" + resultObj.comment[i].mName + "</div>" +
          "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>" +
          "</div>");
        }
      }
    }
  });
}
</script>

<!-- 댓글 삭제 도우미 -->
<script>
function del(id) {
  $('#comno').val(id)
}
</script>

<!-- 댓글 삭제 -->
<script>
$(document).on("click", "#comment-delete-yes", function() {
  var comment_del = new FormData();
  var url = location.href;
  var dno = url.split('?')[1].split('=')[1];
	comment_del.append("comNo", $('#comno').val());
	comment_del.append("dno", dno);
	$('#commentSection').empty();
	$('#Comment-Delete-Check-Modal').modal('hide');

	currentPage = 1;
	$("#comment-more").empty();

	$.ajax({
		url: "../boastboard/ajax/comment_delete.do",
		dataType: 'json',
		cache: false,
		contentType: false,
		processData: false,
		data: comment_del,
		type: 'post',
		success: function(resultObj) {

			totalPage = resultObj.totalPage;
	        if (totalPage > 1) {
	         $("#comment-more").append("<div id='more'><a role='button' class='moreBtn' id='moreBtn' onclick='more()'>댓글 더보기</a></div>");
	        }

      $("#comment-list").replaceWith("<a id='comment-list' onclick='comment()'><span>댓글</span> <span id='comment-list-num'> <span>" + resultObj.count + "</span> </span><i class='fa fa-angle-down'></i></a>");
      for (var i = 0; i < resultObj.comment.length; i++) {
        if ($.session.get('mno') == resultObj.comment[i].mno) {
          $('#commentSection').append(
          "<div class='comment'>" +
          "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>" +
          "<div class='commentname'>" + resultObj.comment[i].mName + "</div>" +
          "<a id='" + resultObj.comment[i].comNo + "' class='comment-delete' onclick='del(this.id)'>" +
          "<i class='fa fa-times' id='comment-delete' data-toggle='modal' data-target='#Comment-Delete-Check-Modal'></i>" +
          "</a>" +
          "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>" +
          "</div>");
        } else {
          $('#commentSection').append(
          "<div class='comment'>" +
          "<img class='commentimg' src='../files/" + resultObj.comment[i].mImg + "'>" +
          "<div class='commentname'>" + resultObj.comment[i].mName + "</div>" +
          "<div class='commenttext'>" + resultObj.comment[i].comComment + "</div>" +
          "</div>");
        }
      }
		}
	});
})
</script>

<script type="text/javascript">
$(document).ready(function() {
  var url = location.href;
  var dno = url.split('?')[1].split('=')[1];
  var like_toggle = 0;

  var detail_data = new FormData();
  detail_data.append("dno", dno);

  $.ajax({
    url : "../boastboard/ajax/detail_image.do",
    dataType : "json",
    type : "POST",
    contentType : false,
    processData : false,
    async: "true",
    data : detail_data,
    success : function(resultObj) {

      var img = $("#img-container-inner");
      var circle = $(".carousel-indicators");

      /* 사진이 1장일 경우 */
      if (resultObj.ImageCount == 1) {
        $("<div class='item active'>").html(
        "<div id='img-section'>" +
        "<img src='../files/" + resultObj.data[0].filename + "' id='img'>" +
        "</div>").appendTo(img);
      }

      /* 사진이 여러 장일 경우 */
      else if (resultObj.ImageCount >= 2) {
        $("<div class='item active'>").html(
        "<div id='img-section'>" +
        "<img src='../files/" + resultObj.data[0].filename + "' id='img'>" +
        "</div>").appendTo(img);
        $("<li data-target='#carousel-example-generic' data-slide-to='0' class='active'></li>").appendTo(circle);

        for(var i = 1; i < resultObj.ImageCount; i++) {
          $("<div class='item'>").html(
          "<div id='img-section'>" +
            "<img src='../files/" + resultObj.data[i].filename + "' id='img'>" +
          "</div>").appendTo(img);
          $("<li data-target='#carousel-example-generic' data-slide-to='0'></li>").appendTo(circle);
        }

        $('#left-control')
        .append("<span class='glyphicon glyphicon-chevron-left' aria-hidden='true'></span>" +
        "<span class='sr-only'>Previous</span>");

        $('#right-control')
        .append("<span class='glyphicon glyphicon-chevron-right' aria-hidden='true'></span>" +
        "<span class='sr-only'>Next</span>");
      }
    }
  });


  // Content 뽑아내는 Ajax
  $.ajax({
    url : "../boastboard/ajax/detail_content.do",
    dataType : "json",
    type : "POST",
    contentType : false,
    processData : false,
    async: "true",
    data : detail_data,
    success : function(resultObj) {
      $('#title').append("<span>" + resultObj.data[0].title + "</span>")
      $('#writer').append("<span><i class='fa fa-user'></i> " + resultObj.data[0].member + "</span>")
      $('#cre_dt').append("<span><i class='fa fa-calendar'></i> " + resultObj.data[0].createDate + "</span>")
      $('#views').append("<span><i class='fa fa-eye'></i> " + resultObj.data[0].view + "</span>")
      $('#likes').append("<span id='likes-span'><i class='fa fa-thumbs-o-up'></i> " + resultObj.data[0].like +
                         "</span>")
      $('#content-content').append("<pre id='content-content-content'>" + resultObj.data[0].content + "</pre>")

      $('#comment-list-num').append("<span>"+resultObj.count+"</span>")


      if ($.session.get('mno') == resultObj.data[0].mno) {
        $('#delete').append("<button type='button' class='btn btn-success' id='delete-Btn' data-toggle='modal' data-target='#Delete-Check-Modal'>삭제</button>");
      }

      // Detail 접속 시 Like 눌렀는지 확인 유무
      var mno = $.session.get('mno');

      if (mno != undefined) {

        var like_check_data = new FormData();
        like_check_data.append("mno", mno);
        like_check_data.append("SCH_NUM", dno);

        $.ajax({
          url : "../boastboard/ajax/detail_like_check.do",
          dataType : "json",
          type : "POST",
          contentType : false,
          processData : false,
          async: false,
          data : like_check_data,
          success : function(resultObj) {
            if (resultObj.like != "" ) {
              $('.fa-thumbs-o-up').css({"color":"blue","font-size": "20px"});
              like_toggle = 1;
            } else {
              $('.fa-thumbs-o-up').css({"color":"#767475","font-size": "17px"});
              like_toggle = 0;
            }
          }
        });
      }
    }
  });

  // 삭제(Delete) 클릭 이벤트
  $('#delete-yes').click(function(event) {
    $.ajax({
      url : "../boastboard/ajax/delete.do",
      dataType : "json",
      type : "POST",
      contentType : false,
      processData : false,
      async: false,
      data : detail_data,
      success : function(resultObj) {
        location.href='boastBoard.html';
        location.replace('boastBoard.html');
      }
    });
  });


  // 좋아요(Likes) Toggle 기능
  $('#likes').click(function(event) {

    var mno = $.session.get('mno');
    var like_data = new FormData();
    like_data.append("mno", mno);
    like_data.append("SCH_NUM", dno);

    if ($.session.get('mno') == undefined) {
      $('#modoinfo').html('로그인 후 이용해주세요.');
      $('#modo').modal('show')
    } else {
      if(like_toggle == 0) {
        $.ajax({
          url : "../boastboard/ajax/like_add.do",
          dataType : "json",
          type : "POST",
          contentType : false,
          processData : false,
          async: false,
          data : like_data,
          success : function(resultObj) {
            $('#likes').empty();
            $('#likes').append("<span id='likes-span'><i class='fa fa-thumbs-o-up'></i> " + resultObj.like + "</span>")
          }
        });

        $('.fa-thumbs-o-up').css({"color":"blue","font-size": "20px"});
        like_toggle = 1;

      } else if(like_toggle == 1) {
        $.ajax({
          url : "../boastboard/ajax/like_delete.do",
          dataType : "json",
          type : "POST",
          contentType : false,
          processData : false,
          async: false,
          data : like_data,
          success : function(resultObj) {
            $('#likes').empty();
            $('#likes').append("<span id='likes-span'><i class='fa fa-thumbs-o-up'></i> " + resultObj.like + "</span>")
          }
        });

        $('.fa-thumbs-o-up').css({"color":"#767475","font-size": "17px"});
        like_toggle = 0;
      }
    }
  });

  /* List 돌아가는 이벤트 */
  $('#list-Btn').click(function(event) {
    location.href='boastBoard.html';
    location.replace('boastBoard.html');
  });
});
</script>



<!-- Log In/Out Script -->
<script>
$(document).ready(function() {
  // 로그인 회원 정보출력 세션없으면 로그인페이지로
  var no = $.session.get('mno');
  var div = $('#user_info');
  var ul = $('#menu-nav-ul');
  if (no == undefined) {
    div.append("<a href='../login.html' id='loginBtn'>로그인</a>")
  } else {
    $('#myMno1').val(no);
    $('#myMno2').val(no);

    div.append(
      "<a role='button' id='msgBtn' class='Msg' href='../messagebox.html'>" +
        "<i class='fa fa-envelope-o'></i>" +
        "<span class='badge' id='userBadge'>0</span>" +
      "</a>" +
      "<img src='../files/" + $.session.get('mimg') + "' id='userImg' />" +
      "<a id='userName' href='../mypage.html'>" + $.session.get('mname') + "</a>" +
      "<a role='button' id='outBtn' class='logout'>" +
        "<i class='fa fa-unlock fa-lg'></i>" +
      "</a>")
    ul.append(
      "<li><a href='../diary.html'><i class='lnr lnr-book'></i> 다이어리</a></li>")

    // 안읽은 받은쪽지 갯수 출력
    var no = $.session.get('mno');

    if (no != undefined) {

      var form_data = new FormData();
      form_data.append("recvMno", no)
      $.ajax({
        url: '../message/ajax/noReadMsg.do',
        type: 'post',
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        success: function(resultObj) {
          var ajaxResult = resultObj.ajaxResult;
          $('#userBadge').html(ajaxResult.data.noReadCount)
        }
      })
    }
  }

  // 로그아웃
  $(document).on("click", "#outBtn", function() {
    $.session.clear();
    location.href = "../login.html"
  });
});
</script>
</body>
</html>
