<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<link rel="icon" href="icon/1.ico" type="image/x-icon" />
<title>Slid Menu</title>

<link href="lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet' type='text/css' />

<!--  내가만든 css들  -->
<link href="css/sh_slidmenu_header_sale.less" type="style.less" rel="stylesheet/less" />
<link href="css/sh_sale.css" type="text/css" rel="stylesheet">

<link href="css/CSSreset.min.css" type="text/css"	rel="stylesheet" />

<!--  폰트아이콘 링크  -->
<link href="lib/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />
<link href="css/icon-font.min.css" type="text/css" rel="stylesheet" />

<!-- 부트스트랩 -->
<script src='lib/jquery/jquery.min.js' type="text/javascript"></script>
<script src="lib/bootstrap/dist/js/bootstrap.js" type="text/javascript"></script>
<script src="lib/less/less.js" type="text/javascript"></script>

<script src="lib/jquery-session-plugin/jquery.session.js" type="text/javascript"></script>

<!-- filter 및 sort Test 중 -->
<script src="mixitup-master/build/jquery.mixitup.min.js" type="text/javascript"></script>
    
<script src="js/sh_jquery.imagelistexpander.js" type="text/javascript"></script>
<script>
$(function(){
    $('#Container').mixItUp();
});
</script>
    
<script src="js/autosize.js" type="text/javascript"></script>

</head>

<body>
  <header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="pet.html">THE PET</a>
      <div id="user_info"></div>
    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i
        class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul id="menu-nav-ul">
          <li><a href="#"><i class="lnr lnr-pencil"></i> 교육</a></li>
          <li><a href="sale.html"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="#"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="#"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="BoastBoard/boastBoard.html"><i class="lnr lnr-paw"></i>
              자랑해요</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
  </header>

  <section id="main-body">
    <!-- 위의 제목 부분 -->
      <span id="boastname"><i class="lnr lnr-store"></i> 분양</span>
    
      <button id="button" class="filter" data-filter="*">All</button>
      <button class="filter" data-filter=".DOG">DOG</button>
      <button class="filter" data-filter=".CAT">CAT</button>
      <button class="filter" data-filter=".FISH">FISH</button>
      <button class="filter" data-filter=".BIRD">BIRD</button>
      <button class="filter" data-filter=".ETC">ETC</button>
      <button id="hidden" class="filter" data-filter="*" hidden="">All</button>
        
        <!--  Filter 영역 시작 -->

        
    <!-- 사진 게시물 영역 -->
    <div id='Container' class='container'>
          
<!--
        <div class='portfoliocard mix DOG' role='button' data-target='#saleModal' data-toggle='modal' id="a" onclick='detail(this.id);'>

            <div class='coverphoto'><img src='images/h10.gif'></div>

            <div class='profile_picture'><img src='images/h1.jpg'></div>

            <div class='left_col'>
                <div class='views'>
                    <div class='view_count'>1234</div>
                    VIEW
                </div>
            </div>

            <div class='right_col'>
                <ul class='contact_information'>
                    <li class='website'>Spec</li>
                    <li class='website'>Type</li>
                    <li class='mail'>Cost</li>
                    <li>................................</li>
                    <li class='title'>Title</li>
                    <li class='resume'>CreateDate</li>
                    <li class='name'>설현</li>
                </ul>
            </div>
        </div>
-->
                    
    </div>

  </section>

<!--펫 디테일 모달-->
<div id='saleModal' class='modal fade' data-keyboard='true'>
    <div class='modal-dialog'>
        <div class='modal-content'>
            <div class='modal-header'>
                <button type='button' class='close' data-dismiss='modal'>
                    <span aria-hidden='true'>&times;</span>
                    <span class='sr-only'>close</span>
                </button>
                <h3 id='modalTitle' class='title'></h3>
            </div>

            <div class='modal-body'>

                <form>
                    <input type="hidden" id="mmatno">
                    <div id='carousel-example-generic' class='carousel slide' data-ride='carousel'>
                        <!-- Indicators -->
                        <ol class='carousel-indicators' id="dots">
<!--                            <li data-target='#carousel-example-generic' data-slide-to='0' class='active'></li>-->
                        </ol>

                        <!-- Wrapper for slides -->
                        <div class="carousel-inner" role="listbox" id="imgs">
<!--                            <div class='item active'><img class='slideimg' src='../images/h1.jpg'></div>-->
                        </div>

                        <!-- Controls -->
                        <a class='left carousel-control' href='#carousel-example-generic' role='button' data-slide='prev'>
                            <span class='glyphicon glyphicon-chevron-left' aria-hidden='true'></span>
                            <span class='sr-only'>Previous</span>
                        </a>
                        <a class='right carousel-control' href='#carousel-example-generic' role="button" data-slide='next'>
                            <span class='glyphicon glyphicon-chevron-right' aria-hidden='true'></span>
                            <span class='sr-only'>Next</span>
                        </a>
                    </div>
                    
                    <div class='contents'>

                        <div class='content' id="mcontent"></div>

                        <div class='input'>
                            <textarea id="comcontent" class='commentin' cols='30' rows='2' placeholder='댓글을 입력하세요...'></textarea>
                            <a id="comDelBtn" role='button'>게시</a>
                        </div>

                        <div class='comments' id="comComment">

<!--
                            <div class='comment'>
                                <img class='commentimg' src=''>
                                <div class="commentname">comUserName</div>
                                <a class='commentDel'><i class='fa fa-close'></i></a>
                                <div class='commenttext'>comComment</div>
                            </div>
-->

                        </div>

                    </div>

                </form>

            </div>

            <div class="modal-footer">
                <button type="button" id="editPet" class="btn btn-warning">변경</button>
                <button type="button" id="delPet" class="btn btn-danger">삭제</button>
            </div>

        </div>
    </div>
</div>
    
<!-- 댓글 삭제 확인 모달 -->
<div id="checkModal" class="modal fade bs-example-modal-sm">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class='modal-header'>
        댓글 삭제
      </div>
      <div class='modal-body'>
        이 댓글을 삭제하시겠어요?
      </div>
      <div class='modal-footer'>
        <button type="button" id="closeDel" class="btn btn-default">취소</button>
        <button type="button" id="delCom" class="btn btn-danger">삭제</button>
      </div>
    </div>
  </div>
</div>
    
  <script>
$(document).ready(function() {
//    로그인 회원 정보출력 세션없으면 로그인페이지로
    var div = $('#user_info');
    var ul = $('#menu-nav-ul')
    if ($.session.get('mno') != undefined) {
        div.append(
            "<img src='files/" + $.session.get('mimg') + "' id='userImg' />" +
            "<a id='userName' href='#'>" + $.session.get('mname') + "</a>" +
            "<a role='button' id='outBtn' class='logout'>" +
            "<i class='fa fa-unlock fa-lg'></i></a>")
        
        ul.append("<li><a href='diary.html'><i class='lnr lnr-book'></i> 다이어리</a></li>")
        
    } else {
        div.append("<a href='login.html' id='loginBtn'>로그인</a>")
        
    }
    
//    로그아웃
    $(document).on("click", "#outBtn", function() {
        $.session.clear();
        location.href = "login.html"
    });
  
});

// mating 리스트 출력
$.getJSON('mating/ajax/list.do', function(resultObj) {
    $("#hidden").trigger("click");
    $("button:first").trigger("click");
    
    var show = $('#Container');
    var j = 0;
    var file;
    var mem;
    for (var mating of resultObj.mating) {
        file = resultObj.filesMap[j];
        mem = resultObj.memberMap[j];
//        console.log(file[0])
//        console.log(mem)
        j++;
        show.append("<div class='portfoliocard mix DOG' role='button' " +
                       "data-target='#saleModal' data-toggle='modal' id='" + mating.matNo + 
                       "' onclick='detail(this.id);'>" +

            "<div class='coverphoto'><img src='images/" + file[0].fileName + "'></div>" +

            "<div class='profile_picture'><img src='files/" + mem.mImg + "'></div>" +

            "<div class='left_col'>" +
                "<div class='views'>" +
                    "<div class='view_count'>" + mating.matViews + "</div>" +
                    "VIEW" +
                "</div>" +
            "</div>" +

            "<div class='right_col'>" +
                "<ul class='contact_information'>" +
                    "<li class='website'>" + mating.matSpec + "</li>" +
                    "<li class='website'>" + mating.matType + "</li>" +
                    "<li class='mail'>" + mating.matCost + "</li>" +
                    "<li class='title'>" + mating.matTitle + "</li>" +
                    "<li class='resume'>" + mating.matCreateDate + "</li>" +
                    "<li class='name'>" + mem.mName + "</li>" +
                "</ul>" +
            "</div>" +
        "</div>")
        }       
});
      
// 펫 디테일
function detail(id) {
    var form_data = new FormData();
    form_data.append("matNo", id)
    $.ajax({
        url: "mating/ajax/detail.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
            var matinfo = re.ajaxResult.data;
            $('#modalTitle').html(matinfo.matTitle);
            $('#mcontent').html(matinfo.matContent);
            $('#mmatno').val(matinfo.matNo);
            var form_data = new FormData();
            form_data.append("matNo", id)
            $.ajax({
                url: "files/ajax/matlist.do",
                dataType: 'json',
                cache: false,
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                success: function(re) {
                    var files = re.ajaxResult.data;
                    var imgs = $('#imgs');
                    var dots = $('#dots');
                    var i = 0;
                    for (var file of files) {
                        if (i == 0) {
                            imgs.append(
                            "<div class='item active'>" +
                                "<img class='slideimg' src='images/" + file.fileName + "'>" +
                            "</div>")
                            dots.append(
                            "<li data-target='#carousel-example-generic' data-slide-to='" + i +
                            "' class='active'></li>")
                        } else {
                            imgs.append(
                            "<div class='item'>" +
                                "<img class='slideimg' src='images/" + file.fileName + "'>" +
                            "</div>")
                            dots.append(
                            "<li data-target='#carousel-example-generic' data-slide-to='" + i +
                            "'></li>")
                        }
                        i++;
                    }
                    var form_data = new FormData();
                    form_data.append("matNo", id)
                    $.ajax({
                        url: "comment/ajax/matcomlist.do",
                        dataType: 'json',
                        cache: false,
                        contentType: false,
                        processData: false,
                        data: form_data,
                        type: 'post',
                        success: function(re) {
                            var commen = re.comments;
                            var comdiv = $('#comComment');
                            var mem;
                            var j = 0;
                            for (var com of commen) {
                                mem = re.memberMap[j];
                                comdiv.append(
                                "<div class='comment'>" +
                                  "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                                  "<div class='commentname'>" + mem.mName + "</div>" +
                                  "<a class='commentDel' data-target='#checkModal' data-toggle='modal'><i class='fa fa-close'></i></a>" +
                                  "<div class='commenttext'>" + com.comComment + "</div>" +
                                "</div>")
                                j++;
                            }
                        }
                    })
                }
            })
        }
    })
}

// 펫 디테일 -> 댓글게시 클릭
$(document).on("click", "#comDelBtn", function() {
  console.log($('#comcontent').val())
  if ($('#comcontent').val() == "") {
    alert("댓글을 입력해 주세요")
  } else {
    var form_data = new FormData();
    form_data.append("matNo", $('#mmatno').val())
    form_data.append("comComment", $('#comcontent').val())
    form_data.append("mno", $.session.get('mno'))
    $.ajax({
      url: "comment/ajax/add.do",
      dataType: 'json',
      cache: false,
      contentType: false,
      processData: false,
      data: form_data,
      type: 'post',
      success: function(re) {
        $('#comcontent').val('')
        var form_data = new FormData();
        form_data.append("matNo", $('#mmatno').val())
        $.ajax({
          url: "comment/ajax/matcomlist.do",
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: 'post',
          success: function(re) {
            $('#comComment').empty();
            var commen = re.comments;
            var comdiv = $('#comComment');
            var mem;
            var j = 0;
            for (var com of commen) {
              mem = re.memberMap[j];
              comdiv.append(
              "<div class='comment'>" +
                "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                "<div class='commentname'>" + mem.mName + "</div>" +
                "<a class='commentDel' data-target='#checkModal' data-toggle='modal'><i class='fa fa-close'></i></a>" +
                "<div class='commenttext'>" + com.comComment + "</div>" +
              "</div>")
              j++;
            }
          }
        })  
      }
    })
  }
})
$(document).on("click", "#delCom", function() {
  alert("삭제클릭")
})


                    
$('#saleModal').on('hide.bs.modal', function(e) {
    $('#comComment').empty();
    $('#dots').empty();
    $('#imgs').empty();
    $('#modalTitle').val('');
    $('#mcontent').val('');
    $('#mmatno').val('');
})

</script>

</body>

</html>
