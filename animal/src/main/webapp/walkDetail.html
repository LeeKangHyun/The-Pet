<!DOCTYPE html>
<html lang="ko">

<head>
    <link rel="icon" href="icon/1.ico" type="image/x-icon" />
    <meta charset="UTF-8">
    <title>산책코스</title>
    <link href="lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet' type='text/css' />
    <!--  상훈 css  -->
    <link href="css/sh_slidmenu_header_diary.less" type="style.less" rel="stylesheet/less" />
    <!-- 강현 css -->
    <link href='css/kh_walk_detail.less' type="style.less" rel='stylesheet/less'/>

    <!--  폰트아이콘 링크  -->
    <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="css/icon-font.min.css" rel="stylesheet" />

    <script src='lib/jquery/jquery.min.js'></script>
    <script src="lib/bootstrap/dist/js/bootstrap.js"></script>
    <script src="lib/less/less.js" type="text/javascript"></script>

    <script src="lib/jquery-session-plugin/jquery.session.js" type="text/javascript"></script>


    <style>
        .wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
        .wrap * {padding: 0;margin: 0;}
        .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
        .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
        .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
        .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
        .info .close:hover {cursor: pointer;}
    </style>

</head>

<body>
  <header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="pet.html">
        <span id="the">THE</span> <span id="P">P</span><span id="et">ET</span>
      </a>
      <a class="headerSubTitle" href="diary.html">
        산책
      </a>
      <div id="user_info">
<!--          <a href='login.html' id='loginBtn'>로그인</a>-->
      </div>
    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul id="menu-nav-ul">
          <li><a href="Education/education.html"><i class="lnr lnr-pencil"></i> 교육</a></li>
          <li><a href="#"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="mating.html"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="walk.html"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="BoastBoard/boastBoard.html"><i class="lnr lnr-paw"></i> 자랑해요</a></li>
          <li><a href='diary.html'><i class='lnr lnr-book'></i> 다이어리</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
  </header>

  <section id="main-body" >

    <div id="left">

      <div id='carousel-example-generic' class='carousel slide' data-ride='carousel' data-wrap='ture' data-interval="false">
        <!-- Indicators -->
        <ol class='carousel-indicators' id="dots"></ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox" id="imgs"></div>

        <!-- Controls -->
        <a class='left carousel-control' href='#carousel-example-generic' role='button' data-slide='prev'>
          <span class='glyphicon glyphicon-chevron-left' aria-hidden='true'>
            <i class="fa fa-arrow-circle-o-left"></i>
          </span>
          <span class='sr-only'>Previous</span>
        </a>
        <a class='right carousel-control' href='#carousel-example-generic' role="button" data-slide='next'>
          <span class='glyphicon glyphicon-chevron-right' aria-hidden='true'>
            <i class="fa fa-arrow-circle-o-right"></i>
          </span>
          <span class='sr-only'>Next</span>
        </a>
      </div>  <!-- 캐러셀 끝 -->

      <div id="detailTitle">
        <h3>
            <!-- 딸랑 딸랑 산책 코스 미리보기 딸랑 딸랑 -->
        </h3>
        <div id="like-section">
        <a role="button" id="likeBtn"><i class="fa fa-thumbs-o-up" id="likes"></i></a>
        <span id="likeCount">1000</span>
        </div>
      </div>  <!-- detailTitle 끝 -->

      <div id="mapNlist">

        <div id='map'></div>  <!-- 지도 출력부분 -->

        <div id="m-list"> <!-- 컨텐트 출력 -->
          <!-- 컨텐트 -->
        </div>  <!-- m-list 끝 -->

      </div>  <!-- mapNlist 끝 -->

      <div class='contents'>

        <!-- 댓글 입력부분 -->
        <div class='input'>
          <img id='comimg' src='images/%EC%84%A4%ED%98%8400008.jpeg'>
          <textarea id="comcontent" class='commentin' cols='30' rows='2' placeholder='댓글을 입력하세요...'></textarea>
          <a id="comAddBtn" role='button'>게시</a>
        </div>

        <!-- 댓글과 버튼을 포함한 구역 -->
        <div class='comments' id="comComment">


        </div>

        <div id="more">
            <a role="button" class="moreBtn" id="m10" onclick='moree(this.id);'>더보기</a>
        </div>

        <!-- 댓글과 버튼을 포함한 구역 끝 -->

      </div> <!-- contents 클래스 끝 -->

    </div> <!-- left 끝 -->

    <div id="right">
      <h4>더 많은 리스트</h4>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">titletitletitletitletitletitletitletitletitletitletitletitletitletitle</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

      <!-- 리스트 항목 -->
      <a class="listbox" role="button">
        <img class="boximg" src="images/h11.gif">
        <div class="content">
          <div class="boxtitle">title2</div>
          <div class="boxwriter">writer</div>
          <div class="boxview">조회수 1010회</div>
          <div class="boxlike"><i class="fa fa-thumbs-o-up"></i> 30</div>
        </div>
      </a>

    </div>

    <!-- 댓글 삭제 확인 모달 -->
    <div id="checkModal" class="modal fade bs-example-modal-sm" data-keyboard='false' data-backdrop='static'>
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class='modal-header'>
            댓글 삭제
          </div>
          <div class='modal-body'>
            이 댓글을 삭제하시겠어요?
            <input type="hidden" id="comno">
          </div>
          <div class='modal-footer'>
            <button type="button" id="closeDel" class="btn btn-default" data-dismiss="modal">취소</button>
            <button type="button" id="delCom" class="btn btn-danger">삭제</button>
          </div>
        </div>
      </div>
    </div>
  </section>

<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=d6f32883b1f882092688e8062e26dd77&libraries=services"></script>
<script type="text/javascript" src='js/kh_map_walkDetail.js'></script>

<script>
var mapno = location.href.split('?')[1].split('=')[1];

$(document).ready(function() {
  // 로그인 회원 정보출력 세션없으면 로그인페이지로
  var no = $.session.get('mno');
  var div = $('#user_info');
  var ul = $('#menu-nav-ul');
  if (no == undefined) {
    div.append("<a href='login.html' id='loginBtn'>로그인</a>")
  } else {
    $('#myMno1').val(no);
    $('#myMno2').val(no);

    div.append(
      "<a role='button' id='msgBtn' class='Msg' href='messagebox.html'>" +
        "<i class='fa fa-envelope-o'></i>" +
        "<span class='badge' id='userBadge'>0</span>" +
      "</a>" +
      "<img src='files/" + $.session.get('mimg') + "' id='userImg' />" +
      "<a id='userName' href='#'>" + $.session.get('mname') + "</a>" +
      "<a role='button' id='outBtn' class='logout'>" +
        "<i class='fa fa-unlock fa-lg'></i>" +
      "</a>")
    ul.append(
      "<li><a href='diary.html'><i class='lnr lnr-book'></i> 다이어리</a></li>")
  }

  // 로그아웃
  $(document).on("click", "#outBtn", function() {
    $.session.clear();
    location.href = "login.html"
  });

});

// 산책 디테일
$.ajax({
    url: 'diary/ajax/walklist.do',
    dataType: 'json',
    async: false,
    cache: false,
    data: {
        "dno": mapno
    },
    type: 'post',
    success: function(re) {
        // var con = $('#m-list');
        // var tit = $('#detailTitle h3');
        // console.log(re);
        // console.log(re.diary.content);

        $('#m-list').html(re.diary.content).appendTo('#mapNlist');
        $('h3').html(re.diary.title).appendTo('#detailTitle');
    }
});

// 사진 디테일
$.ajax({
    url: "files/ajax/list.do",
    dataType: 'json',
    cache: false,
    async: false,
    data: {
        "dno": mapno
    },
    type: 'post',
    success: function(re) {
      var imgs = $("#imgs");
      var dots = $("#dots");
      var files = re.ajaxResult.data;
      var i = 0;
      for (var file of files) {
        if (i == 0) {
          imgs.append(
          "<div class='item active'>" +
            "<img class='slideimg' src='files/" + file.fileName + "'>" +
          "</div>")
          dots.append(
          "<li data-target='#carousel-example-generic' data-slide-to='" + i +
          "' class='active'></li>")
        } else {
          imgs.append(
          "<div class='item'>" +
            "<img class='slideimg' src='files/" + file.fileName + "'>" +
          "</div>")
          dots.append(
          "<li data-target='#carousel-example-generic' data-slide-to='" + i +
          "'></li>")
        }
        i++;
      }
      console.log(re);
    }
});

// 산책 목록부분
$.ajax({
  url: "walk/ajax/list.do",
  data: {
    "dno": mapno
  },
  async: false,
  cache: false,
  type: "get",
  dataType: "json",
  success: function(re) {
    console.log(re);
    coord = new daum.maps.LatLng(re.walkList[0].locLat, re.walkList[0].locLng);
    bounds.extend(coord);
    map.setBounds(bounds)
    marker.setPosition(coord);
    map.panBy(0, -80);
    overlay.setPosition(coord);
    var content =
    '<div class="wrap">' +
    '<div class="info">' +
    '<div class="title">' +
    re.walkList[0].locName +
    '<div class="close" onclick="closeOverlay()" title="닫기"></div>' +
    '</div>' +
    '</div>' +
    '</div>';
    overlay.setContent(content);
  }
});
var i = 0;
// 댓글 부분
var form_data = new FormData();
form_data.append("dno", mapno)
$.ajax({
    url: "comment/ajax/walkcomlist.do",
    dataType: 'json',
    async: false,
    cache: false,
    contentType: false,
    processData: false,
    data: form_data,
    type: 'post',
    success: function(re) {
        console.log(re);
        $('#comComment').empty();
        var commen = re.comments;
        var comdiv = $('#comComment');
        var mem;
        var j = 0;
        for (var com of commen) {
            mem = re.memberMap[j];
            if($.session.get('mno') == mem.mno) {
                comdiv.append(
                "<div class='comment'>" +
                "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                "<div class='commentname'>" + mem.mName + "</div>" +
                "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
                "<i class='fa fa-close'></i></a>" +
                "<div class='commenttext'>" + com.comComment + "</div>" +
                "</div>")
            } else {
                comdiv.append(
                "<div class='comment'>" +
                "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                "<div class='commentname'>" + mem.mName + "</div>" +
                "<div class='commenttext'>" + com.comComment + "</div>" +
                "</div>")
            }
            j++;
        }
    },
    complete: function() {
        i++;
    }
});

// 댓글 부분
$(document).on('click', '#comAddBtn', function() {
    if ($('#comcontent').val() == "") {
      alert("댓글을 입력해 주세요")
    } else {
        var form_data = new FormData();
        form_data.append("dno", mapno)
        form_data.append("comComment", $('#comcontent').val())
        form_data.append("mno", $.session.get('mno'))
        $.ajax({
            url: "comment/ajax/walkcom.do",
            dataType: 'json',
            cache: false,
            async: false,
            contentType: false,
            processData: false,
            data: form_data,
            type: 'post',
            success: function(re) {
            $('#comcontent').val('')
            var form_data = new FormData();
            form_data.append("dno", mapno)
            $.ajax({
                url: "comment/ajax/walkcomlist.do",
                dataType: 'json',
                cache: false,
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                success: function(re) {
                    $('#comComment').empty();
                    var commen = re.comments;
                    var comdiv = $('#comComment');
                    var mem;
                    var j = 0;
                    for (var com of commen) {
                        mem = re.memberMap[j];
                        if($.session.get('mno') == mem.mno) {
                            comdiv.append(
                            "<div class='comment'>" +
                            "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                            "<div class='commentname'>" + mem.mName + "</div>" +
                            "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
                            "<i class='fa fa-close'></i></a>" +
                            "<div class='commenttext'>" + com.comComment + "</div>" +
                            "</div>")
                        } else {
                            comdiv.append(
                            "<div class='comment'>" +
                            "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                            "<div class='commentname'>" + mem.mName + "</div>" +
                            "<div class='commenttext'>" + com.comComment + "</div>" +
                            "</div>")
                        }
                        j++;
                    }
                    $('#more').empty();
                    $('#more').append(
                        '<a role="button" class="moreBtn" id="m10" onclick="moree(this.id);">더보기</a>'
                    );
                    i=1;
                }
            })
          }
        })
    }
});

// 댓글 삭제 도우미
function del(id) {
    $('#comno').val(id)
    $('#checkModal').modal('show')
}

// 댓글 삭제
$(document).on("click", "#delCom", function() {
    var form_data = new FormData();
    console.log($('#comno').val())
    form_data.append("comNo", $('#comno').val())
    $.ajax({
        url: "comment/ajax/delete.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
            $('#checkModal').modal('hide')
            var form_data = new FormData();
            form_data.append("dno", mapno)
            $.ajax({
                url: "comment/ajax/walkcomlist.do",
                dataType: 'json',
                cache: false,
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                success: function(re) {
                    $('#comComment').empty();
                    var commen = re.comments;
                    var comdiv = $('#comComment');
                    var mem;
                    var j = 0;
                    for (var com of commen) {
                        mem = re.memberMap[j];
                        comdiv.append(
                        "<div class='comment'>" +
                        "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                        "<div class='commentname'>" + mem.mName + "</div>" +
                        "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
                        "<i class='fa fa-close'></i></a>" +
                        "<div class='commenttext'>" + com.comComment + "</div>" +
                        "</div>")
                        j++;
                    }
                }
            })
        }
    })
})

// 더보기 부분
function moree(id) {
    i++;
    console.log(id);
    var page = id.substring(1);
    console.log(page);
    var cpage = i;
    var form_data = new FormData();
    form_data.append("dno", mapno)
    form_data.append("pageNo", page)
    $.ajax({
        url: "comment/ajax/walkcomlist.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
            var commen = re.comments;
            var comdiv = $('#comComment');
            var mem;
            var j = 0;
            for (var com of commen) {
                mem = re.memberMap[j];
                if($.session.get('mno') == mem.mno) {
                    comdiv.append(
                    "<div class='comment'>" +
                    "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                    "<div class='commentname'>" + mem.mName + "</div>" +
                    "<a class='commentDel' id='" + com.comNo + "' onclick='del(this.id)'>" +
                    "<i class='fa fa-close'></i></a>" +
                    "<div class='commenttext'>" + com.comComment + "</div>" +
                    "</div>")
                } else {
                    comdiv.append(
                    "<div class='comment'>" +
                    "<img class='commentimg' src='files/" + mem.mImg + "'>" +
                    "<div class='commentname'>" + mem.mName + "</div>" +
                    "<div class='commenttext'>" + com.comComment + "</div>" +
                    "</div>")
                }
                j++;
            }
            $("#hidden").trigger("click");
            $("button:first").trigger("click");

            $.getJSON('comment/ajax/pages.do?dno=' + mapno, function(resultObj) {
                var ajaxResult = resultObj.ajaxResult;
                console.log(cpage);
                if (ajaxResult.data == cpage) {
                    console.log("더보기 끝")
                    $('#more').empty();

                } else {
                    console.log("더보기 생성")
                    var more = $('#more');
                    $('#more').empty();
                    var i = parseInt(page)+10;
                    console.log(i);
                    more.append(
                          "<a role='button' class='moreBtn' id='m" + i + "' onclick='moree(this.id);'>더보기</a>")
                }
            })
        }
    })
};
</script>

<script>
var like_toggle = 0;

	 <!-- 좋아요(Likes) Toggle 기능 -->
	 $('#likes').click(function(event) {
/* 	   var mno = $.session.get('mno'); */
/* 	   var like_data = new FormData();
	   like_data.append("mno", mno);
	   like_data.append("SCH_NUM", no); */


	   if ($.session.get('mno') == undefined) {

	     alert("로그인 후 이용해주십시오.");

	   } else {

	     if(like_toggle == 0) {
/* 	        $.ajax({
	             url : "../boastboard/ajax/like_add.do",
	             dataType : "json",
	             type : "POST",
	             contentType : false,
	             processData : false,
	             async: false,
	             data : like_data,
	             success : function(resultObj) { */
	               $('#likeCount').remove();
	               $('#like-section').append("<span id='likeCount'>" + 1001 + "</span>")
/* 	             } });  */

	        $('#likes').css({"color":"blue","font-size": "25px"});
	          like_toggle = 1;

	     } else if(like_toggle == 1) {

	     /*      $.ajax({
	             url : "../boastboard/ajax/like_delete.do",
	             dataType : "json",
	             type : "POST",
	             contentType : false,
	             processData : false,
	             async: false,
	             data : like_data,
	             success : function(resultObj) { */
	               $('#likeCount').remove();
	               $('#like-section').append("<span id='likeCount'>" + 1000 + "</span>")
	     /*         } }); */

	         $('#likes').css({"color":"#767475","font-size": "25px"});
	         like_toggle = 0;
	     }

	   }

	 });
</script>
</body>

</html>
