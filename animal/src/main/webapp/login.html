<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="icon" href="icon/1.ico" type="image/x-icon" />
  <title>Slid Menu</title>
  <!--  내가만든 css들  -->
  <link href="css/sh_animals.css" type="text/css" rel="stylesheet" />
  <link href="css/sh_login.css" type="text/css" rel="stylesheet" />
  <link href="css/sh_slidmenu_header.less" type="style.less" rel="stylesheet/less" />

  <link href="lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet' type='text/css' />

  <!--  폰트아이콘 링크  -->
  <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
  <link href="css/icon-font.min.css" rel="stylesheet" />

  <!--  파일 업로드  -->
  <link href="css/sh_file_upload.css" rel="stylesheet" type="text/css" />
  <script>
    (function(e, t, n) {
      var r = e.querySelectorAll("html")[0];
      r.className = r.className.replace(/(^|\s)no-js(\s|$)/, "$1js$2")
    })
    (document, window, 0);
  </script>

  <script src='lib/jquery/jquery.min.js' type="text/javascript"></script>
  <script src="lib/bootstrap/dist/js/bootstrap.js" type="text/javascript"></script>
  <script src="lib/less/less.js" type="text/javascript"></script>
    
  <script src="lib/jquery.cookie/jquery.cookie.js" type="text/javascript"></script>
  <script src="lib/jquery-session-plugin/jquery.session.js" type="text/javascript"></script>
    
  <script src="js/sh_login_reg_check.js" type="text/javascript"></script>

  <!--[if IE]>
  		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

</head>

<body>
  <!--<body style="background-color:black;">-->
<header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="pet.html">THE PET</a>

      <div id="user_info">
      </div>

    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul>
          <li><a href="#"><i class="lnr lnr-pencil"></i> 교육</a></li>
          <li><a href="#"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="#"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="#"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="boastBoard.html"><i class="lnr lnr-paw"></i> 자랑해요</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
</header>

  <section id="main-body">
    <div>

<!--
      <div class="dog">
        <div class="dog_ear left"></div>
        <div class="dog_ear right"></div>
        <div class="dog_eye_right"></div>
        <div class="dog_eye"></div>
        <div class="dog_eye"></div>
        <div class="dog_mouth_2"></div>
        <div class="dog_nose"></div>
        <div class="dog_mouth"></div>
      </div>
-->

      <div class="container">

        <h3 class="sign-in">로그인</h3>
        <a data-toggle="modal" data-target="#registerModal" class="button" role="button">회원가입</a>

        <form>

          <div class="group1">
            <input name="mEmail" id="lmEmail" class="iput" type="text" required>
            <span class="highlight"></span>
            <span class="bar"></span>
            <label class="lname">EMAIL</label>
          </div>

          <div class="group2">
            <input name="password" id="lpassword" class="iput" type="password" required>
            <span class="highlight"></span>
            <span class="bar"></span>
            <label class="lname">PASSWORD</label>
          </div>

          <div class="saveEmail">Remember me</div>

          <div class="switch">
            <input type="checkbox" name="saveEmail" id="lsaveEmail">
            <label for="saveEmail">
              <span class="fa fa-check"></span>
              <span class="fa fa-times"></span>
              <div></div>

            </label>
          </div>

          <input type="button" id="loginBtn" value="로그인" />

        </form>

<!--
        <div class="cat">
          <div class="cat_eye_left"></div>
          <div class="cat_eye_right"></div>
          <div class="cat_ear left"></div>
          <div class="cat_ear right"></div>
          <div class="cat_eye_l"></div>
          <div class="cat_eye_in_l"></div>
          <div class="cat_eye_r"></div>
          <div class="cat_eye_in_r"></div>
          <div class="cat_nose"></div>
          <div class="cat_mouth"></div>
          <div class="cat_mouth_tooth"></div>
        </div>
-->

        <p class="footer">

        </p>

      </div>

    </div>
  </section>

  <!-- 회원가입 구간 -->

  <div class="modal fade" id="registerModal" role="dialog" data-keyboard="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
          </button>
          <h3 class="modal-title" id="lineModalLabel">회원가입</h3>
        </div>

        <div class="modal-body">

          <form>
            <div class="panel panel-default">

              <div class="panel-body">
                  
                <div id="mEmailForm" class="form-group has-feedback">
                  <label for="mEmail">이메일</label>
                  <input type="text" id="mEmail" name="mEmail" class="form-control"  onchange="check(this.id);" placeholder="ex) the-pet@pet.xyz" autofocus="true" >
                  <div class="control-label" id="mEmailMsg" style="display: none;">
                      이메일 형식이 아닙니다.
                  </div>
                </div>

                <hr>
                <div id="passwordForm" class="form-group has-feedback">
                  <label for="password">비밀번호</label>
                  <input type="password" class="form-control" id="password" name="password"  onchange="check(this.id);" placeholder="비밀번호를 입력하세요.">
                  <div class="control-label" id="passwordMsg" style="display: none;">
                    숫자, 영문 대/소문자, 특수문자 각 한자이상 필수 최대8~20자입니다.
                  </div>
                </div>

                <div id="password2Form" class="form-group has-feedback">
                  <label for="password2">비밀번호 재입력</label>
                  <input type="password" class="form-control" id="password2" name="password2" placeholder="비밀번호를 재입력하세요." onchange="check(this.id);" required>
                  <div class="control-label" id="password2Msg" style="display: none;">
                      필수 정보입니다.
                  </div>
                </div>

                <hr>
                <div id="mNameForm" class="form-group has-feedback">
                  <label for="mName">이름</label>
                  <input type="text" class="form-control" id="mName" name="mName" maxlength="20" autofocus="true" placeholder="이름을 입력하세요." onchange="check(this.id);">
                  <div class="control-label" id="mNameMsg" style="display: none;">
                    양식에 맞게 입력해주세요
                  </div>
                </div>

                <div id="telForm" class="form-group has-feedback">
                  <label for="tel">휴대전화번호</label>
                  <input type="text" class="form-control" id="tel" name="tel" placeholder="ex) 010-1234-5678" onchange="check(this.id);">
                  <div class="control-label" id="telMsg" style="display: none;">
                    양식에 맞게 입력해주세요
                  </div>
                </div>

                <div class="box">
                  <input type="file" name="mImg" id="file-1" class="inputfile inputfile-1" />
                  <label for="file-1">
                    <i class="fa fa-upload"></i>
                    <span>프로필 이미지 추가</span>
                  </label>
                </div>

                <hr>
                <div class="form-group">
                  <input type="button" id="joinBtn" value="가입하기">
                  <!-- 가입</button>-->
                </div>
              </div>

            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
  <!-- /회원가입 구간 -->

  <!-- 파일 업로드 파일 이름뜨는부분 -->
<script src="js/sh_custom-file-input.js"></script>
    
  <!--  중복확인 스크립트  -->
<script>
$(document).ready(function() {
    var login_email = $.cookie("saved");
    if (login_email != undefined) {
        $('#lmEmail').val(login_email);
        $('#lsaveEmail').prop("checked", true);
    }
    
    $('#loginBtn').click(function(event) {
        if ($('#lmEmail').val() == "") {
            alert("아이디를 입력하세요")
            return;
        }
        if ($('#lpassword').val() == "") {
            alert("패스워드를 입력하세요")
            return;
        }

        var saveEmail = $('#lsaveEmail').is(':checked');
        if (saveEmail) {
            $.cookie("saved", $('#lmEmail').val(), {expires : 30, path: '/'}); 
        } else {
            $.removeCookie("saved", { path: '/'});
        }

        $.post('auth/ajax/login.do', {
            mEmail: $('#lmEmail').val(),
            password: $('#lpassword').val(),

        }, function(resultObj) {
            var ajaxResult = resultObj.ajaxResult;
            if (ajaxResult.status == "success") {
                $.session.set("mno", ajaxResult.data.mno)
                $.session.set("mname", ajaxResult.data.mName)
                $.session.set("memail", ajaxResult.data.mEmail)
                $.session.set("tel", ajaxResult.data.tel)
                $.session.set("mimg", ajaxResult.data.mImg)
                
                alert("로그인성공")
                location.href = "diary.html"
            } else {
                alert("로그인에 실패했습니다.")
            }
        }, 'json');
    });
    
    $('#registerModal').on('hide.bs.modal', function (e) {
        $(':text:not([id=lmEmail])').val('');
        $(':password').val('');
        $(':file').val('');

        $('#mEmailForm').removeClass("has-success");
        $('#passwordForm').removeClass("has-success");
        $('#password2Form').removeClass("has-success");
        $('#mNameForm').removeClass("has-success");
        $('#telForm').removeClass("has-success");

        $('#mEmailForm').removeClass("has-error");
        $('#passwordForm').removeClass("has-error");
        $('#password2Form').removeClass("has-error");
        $('#mNameForm').removeClass("has-error");
        $('#telForm').removeClass("has-error");
        
        $('#mEmailMsg').html("");
        $('#passwordMsg').html("");
        $('#password2Msg').html("");
        $('#mNameMsg').html("");
        $('#telMsg').html("");
    })
    
    $('#joinBtn').click(function(event) {
        if ($('#mEmail').val() == "" || 
            $('#mEmailForm').attr('class') == "form-group has-feedback" ||
            $('#mEmailForm').attr('class') == "form-group has-feedback has-error") {
            alert("이메일을 입력해주세요")
            $('#mEmail').focus();
            return false;
        } else if ($('#password').val() == "" || 
            $('#passwordForm').attr('class') == "form-group has-feedback" ||
            $('#passwordForm').attr('class') == "form-group has-feedback has-error") {
            alert("패스워드를 입력해주세요")
            $('#password').focus();
            return false;
        } else if ($('#password2').val() == "" || 
            $('#password2Form').attr('class') == "form-group has-feedback" ||
            $('#password2Form').attr('class') == "form-group has-feedback has-error") {
            alert("패스워드를 재입력해주세요")
            $('#password2').focus();
            return false;
        } else if ($('#mName').val() == "" || 
            $('#mNameForm').attr('class') == "form-group has-feedback" ||
            $('#mNameForm').attr('class') == "form-group has-feedback has-error") {
            alert("이름을 입력해주세요")
            $('#mName').focus();
            return false;
        } else if ($('#tel').val() == "" || 
            $('#telForm').attr('class') == "form-group has-feedback" ||
            $('#telForm').attr('class') == "form-group has-feedback has-error") {
            alert("전화번호를 입력해주세요")
            $('#tel').focus();
            return false;
        } else {
            $.getJSON('member/ajax/checkEmail.do?mEmail=' + $('#mEmail').val(), 
                function(resultObj) {
                    var ajaxResult = resultObj.ajaxResult;
                    if (ajaxResult.status == "success") {
                        alert("중복 이메일입니다.")
                        $('#mEmail').val('');
                        $(':password').val('');

                        $('#mEmailForm').removeClass("has-success");
                        $('#passwordForm').removeClass("has-success");
                        $('#password2Form').removeClass("has-success");

                        $('#mEmailMsg').html("");
                        $('#passwordMsg').html("");
                        $('#password2Msg').html("");
                        return false;
                    }
    //                alert("사용가능")
                    var file_data = $("#file-1").prop("files")[0];
                    var file;

                    if (file_data != null) {   
                        file = "no";
                        var file_name = file_data.name;
                    }

                    var form_data = new FormData();
                    form_data.append("file", file_data)

                    if (file != "no") {
                        form_data.append("fName", file_name)
                    }
                    form_data.append("fName", "default.jpg")

                    form_data.append("mEmail", $('#mEmail').val())
                    form_data.append("password", $('#password').val())
                    form_data.append("mName", $('#mName').val())
                    form_data.append("tel", $('#tel').val())

                    $.ajax({
                        url : "member/ajax/add.do",
                        dataType : 'json',
                        cache : false,
                        contentType : false,
                        processData : false,
                        data : form_data,
                        type : 'post',
                        success : function(re) {
                            $('#registerModal').modal('hide')
                            alert("회원가입을 축하합니다")
                        }
                    })
                }, 'json');
        }
    });
})
</script>

</body>

</html>
