<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="icon" href="../icon/1.ico" type="image/x-icon" />
<title>Slid Menu</title>

<link href="../lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet'
  type='text/css' />

<!--  내가만든 css들  -->
<link href="../css/sh_slidmenu_header_diary.less" type="style.less"
  rel="stylesheet/less" />

<!--  폰트아이콘 링크  -->
<link href="../lib/font-awesome/css/font-awesome.min.css"
  rel="stylesheet" />
<link href="../css/icon-font.min.css" rel="stylesheet" />

<!-- 부트스트랩 -->
<script src='../lib/jquery/jquery.min.js'></script>
<script src="../lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="../lib/less/less.js" type="text/javascript"></script>

<script src="../lib/jquery-session-plugin/jquery.session.js"
  type="text/javascript"></script>

<!-- 대진 css & js -->
<link href="../css/dj_main.css" type="text/css" rel="stylesheet">
<link href="../css/dj_pictures.css" type="text/css" rel="stylesheet">

<!-- filter 및 sort Test 중 -->
<script src="../mixitup-master/build/jquery.mixitup.min.js"></script>

<link href="../css/sh_file_upload.css" rel="stylesheet" type="text/css" />

</head>
<body>
  <header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="../pet.html">THE PET</a>
      <div id="user_info"></div>
    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i
        class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul>
          <li><a href="education.html"><i class="lnr lnr-pencil"></i>
              교육</a></li>
          <li><a href="#"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="#"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="#"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="../BoastBoard/boastBoard.html"><i
              class="lnr lnr-paw"></i> 자랑해요</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
  </header>

  <section>
    <div class="m_content" style="width: 973px;">
      <!-- 위의 제목 부분 -->
      <ol>
        <li style="margin-left: -100px;">
          <h1>
            <i class="lnr lnr-pencil"></i> 교육
          </h1>
        </li>
      </ol>
      <!-- 위의 제목 부분 끝 -->

      <hr>
      <div style="text-align: left; margin-bottom: 30px;">
        <button id="button" class="filter" data-filter="*">All</button>
        <button class="filter" data-filter=".DIV01">DOG</button>
        <button class="filter" data-filter=".DIV02">CAT</button>
        <button class="filter" data-filter=".DIV03">FISH</button>
        <button class="filter" data-filter=".DIV04">BIRD</button>
        <button class="filter" data-filter=".DIV05"
          style="margin-right: 560px;">ETC</button>
        <span id='scheduleAdd'></span>
      </div>

      <!-- 새로운 게시글 모달 부분 -->
      <div class="modal fade" id="AddBoard" role="dialog"
        data-keyboard="true">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">
                <span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
              </button>
              <h3 class="modal-title" id="lineModalLabel">글 추가</h3>
            </div>

            <div class="modal-body">

              <form>
                <!--                    novalidate-->
                <input type="hidden" name="mno" id="myMno2">

                <div class="form-group">
                  <label for="eduSpec" class="col-sm-2 control-label">카테고리</label>
                  <div class="col-sm-10">
                    <select id="eduSpec" name="eduSpec" class="form-control">
                      <option value="DIV01" selected="selected">강아지</option>
                      <option value="DIV02">고양이</option>
                      <option value="DIV03">물고기</option>
                      <option value="DIV04">새</option>
                      <option value="DIV05">ETC</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="eduTitle" class="col-sm-2 control-label">제목</label>
                  <div class="col-sm-10">
                    <input type="text" name="eduTitle" class="form-control"
                      id="eduTitle" required>
                  </div>
                </div>

                <div class="form-group">
                  <label for="eduContent" class="col-sm-2 control-label">내용</label>
                  <div class="col-sm-10">
                    <textarea id="eduContent" name="eduContent" class="form-control"
                      rows='10' cols='60' required></textarea>
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="fileUrl" class="col-sm-2 control-label">url</label>
                  <div class="col-sm-10">
                    <input type="text" name="fileUrl" class="form-control"
                      id="fileUrl" required>
                  </div>
                </div>
                
                <div class="box">
                   <label
                    for="file-1">
                  </label>
                </div>

                <div class="form-group" style="text-align:right">
                  <div class="col-sm-offset-2 col-sm-10">
                    <button id='addBtn' type='button'
                      class="newForm btn btn-primary btn-xs">등록</button>
                  </div>
                </div>

              </form>

            </div>

          </div>
        </div>
      </div>
      <!-- //게시글 추가 모달 -->

      <!-- 사진 게시물 영역 -->
      <div id="Container" class="container"
        style="margin-left: -10px; padding: 0px;">
        <div id="subtable" style="text-align: left;"></div>
      </div>
      <!-- 사진 게시물 영역 끝 -->

    </div>
  </section>
  <script>
  $(document).ready(function() {
    $.ajax({
      url : 'education/ajax/list.do',
      dataType : 'json',
      type : "get",
      contentType : "multipart/form-data",
      async : false,
      cache : true,
      success : function(resultObj) {
        $("button:first").trigger("click");
        var div = $("#subtable");
        var j = 0;
        var file;
        for(var education of resultObj.data) {
            file = resultObj.filesMap[j];
            j++;
          $("<div class='boxsub1 gallery mix all " + education.eduSpec + "'>")
          .html(
              "<div class='card'>"+
              "<div class='background detailLnk' eduNo='" + education.eduNo + "'></a>"+
              "<video src='../files/" + file[0].fileName + "' width='325px;' height='410px;' />"+
              "</div>"+
              "<a class='overlay detailLnk' eduNo='" + education.eduNo + "'></a>" + 
              "<i class='fa fa-youtube-play'></i>"+
              "</a> <a class='thumb' href='#'></a>"+
              "<div class='infosub'>"+
              "<h2>"+
              "<a class='detailLnk' eduNo='" + education.eduNo + "' href='#'>" + education.eduTitle + "</a>"+
              "</h2>"+
              "<div class='foot'>"+
              "<i class='line'></i> <span class='date' style='padding-right:120px;'>" + education.eduCreateDate + "</span>"+
              "<span id='view-like'><i class='fa fa-eye'></i> " + education.eduViews + 
              "</span>"+
              "</div>"+
              "</div>"+
          "</div>")
          .appendTo(div);
        }
        $("a.detailLnk").click(clickDetailLnk);
      }
    }); 
    $(document).on("click", "#addBtn", function(event) {
        if ($('#eduTitle').val() == "" ||
          $('#eduContent').val() == "" ||
          $('#file-1').val() == "") {
          alert("모두 입력해주세요")
          return false;
        } else {
          var form_data = new FormData();
          form_data.append("mno", 1)
          form_data.append("eduSpec", $('#eduSpec').val())
          form_data.append("eduTitle", $('#eduTitle').val())
          form_data.append("eduContent", $('#eduContent').val())
          console.log($('eduSpec'));
          console.log(eduTitle);
          console.log(eduContent);
          $.ajax({
            url: "education/ajax/add.do",
            dataType: 'json',
            cache: false,
            contentType: false,
            processData: false,
            data: form_data,
            type: 'post',
            success: function(re) {
              var eduNo = re.ajaxResult.data;
                var file_name = $("#fileUrl");
                var form_data = new FormData();
                form_data.append("fName", file_name)
                form_data.append("eduNo", eduNo)
                $.ajax({
                  url: "../files/ajax/eduupload.do",
                  dataType: 'json',
                  cache: false,
                  contentType: false,
                  processData: false,
                  data: form_data,
                  type: 'post',
                  success: function(resultObj) {
                  }
                })
              alert("게시물이 추가되었습니다.")
              location.href = "education.html"
            }
          })
        }
      });
    function clickDetailLnk(event) {
      event.preventDefault(); 
      location.href = "edu_form.html?eduNo=" + $(event.target).attr("eduNo");
    }
  });
  
  $(function(){
    $('#Container').mixItUp();
  });
  </script>

  <script>
  $(document).ready(function() {
     var div = $('#user_info');
     var btn = $('#scheduleAdd');
     if ($.session.get('mno') == undefined) {
         div.append("<a href='../login.html' id='loginBtn'>로그인</a>");
     } else if ($.session.get('mno') == 1) {
         div.append(
         "<img src='../files/" + $.session.get('mimg') +
         "' id='userImg' />" +
         "<a id='userName' href='#'>" + $.session.get('mname') + "</a>" +
         "<a role='button' id='outBtn' class='logout'>" +
         "<i class='fa fa-unlock fa-lg'></i></a>");
         btn.append(
             "<a class='btn btn-default' id='scheduleAdd' role='button'"
             + "data-toggle='modal' data-target='#AddBoard'>New</a>"
             );
     } else {
         div.append(
         "<img src='../files/" + $.session.get('mimg') +
         "' id='userImg' />" +
         "<a id='userName' href='#'>" + $.session.get('mname') + "</a>" +
         "<a role='button' id='outBtn' class='logout'>" +
         "<i class='fa fa-unlock fa-lg'></i></a>")
     }

     //    로그아웃
     $(document).on("click", "#outBtn", function() {
       $.session.clear();
       location.href = "../login.html"
     });
  });
  </script>

</body>

</html>
