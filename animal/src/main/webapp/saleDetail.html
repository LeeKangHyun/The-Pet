<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="icon" href="icon/1.ico" type="image/x-icon" />
  <title>짝짓기</title>

  <link href="lib/bootstrap/dist/css/bootstrap.css" rel='stylesheet' type='text/css' />

  <!--  내가만든 css들  -->
  <link href="css/sh_slidmenu_header_saledetail.css" type="text/css" rel="stylesheet">
  <link href="css/sh_mating_detail.css" type="text/css" rel="stylesheet">
  <link href="css/CSSreset.min.css" type="text/css" rel="stylesheet" />

  <!--  폰트아이콘 링크  -->
  <link href="lib/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />
  <link href="css/icon-font.min.css" type="text/css" rel="stylesheet" />

  <!-- 부트스트랩 -->
  <script src='lib/jquery/jquery.min.js' type="text/javascript"></script>
  <script src="lib/bootstrap/dist/js/bootstrap.js" type="text/javascript"></script>

  <script src="lib/jquery-session-plugin/jquery.session.js" type="text/javascript"></script>

  <!-- filter 및 sort Test 중 -->
  <!-- <script src="mixitup-master/build/jquery.mixitup.min.js" type="text/javascript"></script> -->

  <script src="js/sh_custom-file-input.js"></script>

  <!--  파일 업로드  -->
  <!--<link href="css/sh_file_upload.css" rel="stylesheet" type="text/css" />-->
  <script>
    (function(e, t, n) {
      var r = e.querySelectorAll("html")[0];
      r.className = r.className.replace(/(^|\s)no-js(\s|$)/, "$1js$2")
    })
    (document, window, 0);
  </script>

</head>

<body>
  <header id="menu">
    <div id="header_title">
      <a class="headerTitle" href="pet.html">
        <span id="the">THE</span> <span id="P">P</span><span id="et">ET</span>
      </a>
      <a class="headerSubTitle" href="sale.html">
        분양
      </a>
      <div id="user_info"></div>
    </div>
    <!--  메뉴 버튼  -->
    <input type="checkbox" id="menuToggle" />

    <div id="sideMenu">
      <label for="menuToggle" id="menu-icon"><i class="fa fa-bars fa-lg"></i></label>
      <!--  메뉴 내용  -->

      <nav id="menu-nav">
        <ul id="menu-nav-ul">
          <li><a href="Education/education.html"><i class="lnr lnr-pencil"></i> 교육</a></li>
          <li><a href="sale.html"><i class="lnr lnr-store"></i> 분양</a></li>
          <li><a href="mating.html"><i class="lnr lnr-heart"></i> 짝짓기</a></li>
          <li><a href="walk.html"><i class="lnr lnr-leaf"></i> 산책코스</a></li>
          <li><a href="BoastBoard/boastBoard.html"><i class="lnr lnr-paw"></i>
              자랑해요</a></li>
        </ul>
      </nav>
      <!--  //메뉴 내용  -->
    </div>
  </header>

  <section id="main-body">

    <div class='main-body'>

      <input type="hidden" id="msno">

      <div id='carousel-example-generic' class='carousel slide' data-ride='carousel' data-wrap='true' data-interval="false">


        <!-- Indicators -->
        <ol class='carousel-indicators' id="dots"></ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox" id="imgs"></div>

        <!-- Controls -->
        <a class='left carousel-control' href='#carousel-example-generic' role='button' data-slide='prev'>
          <span class='glyphicon glyphicon-chevron-left' aria-hidden='true'></span>
          <span class='sr-only'>Previous</span>
        </a>
        <a class='right carousel-control' href='#carousel-example-generic' role="button" data-slide='next'>
          <span class='glyphicon glyphicon-chevron-right' aria-hidden='true'></span>
          <span class='sr-only'>Next</span>
        </a>
      </div>

      <div class='contents'>

        <h3 id='modalTitle' class='title'>title</h3>

        <div class='content' id="mcontent">
          <textarea id="contentText" readonly>textarea</textarea>
        </div>

        <div id="sendmsg">
          <a id="msg" role="button" data-target="#sendMsg" data-toggle='modal'><i class='fa fa-envelope-o'></i></a>
        </div>

        <div class='input'>

          <div id="forms">
            <span class="gg">펫 종류</span>
            <input type="text" name="s_gen" placeholder="ex) 포메라니안" id="mmtype" class="form-control">
          </div>

          <textarea id="comcontent" class='commentin' cols='30' rows='2' placeholder='댓글을 입력하세요...'></textarea>
          <a id="comDelBtn" role='button'>게시</a>
        </div>

        <div class='comments' id="comComment"></div>
        <div id="more">
          <a role="button" class="moreBtn" id="m10" onclick='moree(this.id);'>더보기</a>
        </div>


        <div id="delImg"></div>
      </div>


    </div>

    <div class="main-footer">

      <div class="box">
        <input type="file" name="files" id="file-1" class="inputfile inputfile-1" data-multiple-caption="{count}개의 파일이 선택되었습니다" multiple />
        <label for="file-1">
          <i class="fa fa-upload"></i>
          <span>이미지 추가</span>
        </label>
      </div>

      <button type="button" id="editCancel" class="btn btn-default">취소</button>
      <button type="button" id="editEnd" class="btn btn-warning" style="display:none;">변경완료</button>
      <button type="button" id="editPet" class="btn btn-warning">변경</button>
      <button type="button" id="matDelBtn" class="btn btn-danger">삭제</button>
    </div>

  </section>
  <!-- 댓글 삭제 확인 모달 -->
  <div id="checkModal" class="modal fade bs-example-modal-sm" data-keyboard='false' data-backdrop='static'>
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class='modal-header'>
          댓글 삭제
        </div>
        <div class='modal-body'>
          이 댓글을 삭제하시겠어요?
          <input type="hidden" id="comno">
        </div>
        <div class='modal-footer'>
          <button type="button" id="closeDel" class="btn btn-default" data-dismiss="modal">취소</button>
          <button type="button" id="delCom" class="btn btn-danger">삭제</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 오류 모달 -->
  <div id="noCom" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <i class="fa fa-exclamation-triangle"></i> 에러!
        </div>

        <div class="modal-body">
          댓글을 입력해주세요
        </div>

        <div class="modal-footer">
          <button type="button" id="okok" class="btn btn-primary" data-dismiss="modal">확인</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 쪽지 보내기 모달 -->
  <div id="sendMsg" class="modal fade" data-keyboard="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">close</span>
          </button>
          <h3 id="modalTitle" class="modal-title">쪽지 보내기</h3>
        </div>

        <div class="modal-body">

          <div class="form-group">
            <label for="pdType" class="col-sm-12 control-label">받는사람</label>
            <div class="col-sm-12">
              <input type="text" class="form-control" id="sendName">
            </div>
          </div>
          <br>
          <div class="form-group">
            <label for="pdType" class="col-sm-12 control-label">내용</label>
            <div class="col-sm-12">
              <textarea class="form-control" id="msgText"></textarea>
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" id="sendMsgBtn" class="btn btn-primary">보내기</button>
        </div>

      </div>
    </div>
  </div>

  <!-- 알림 모달 -->
  <div id="modo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <i class="fa fa-info"></i> 알림
        </div>

        <div class="modal-body">
          <span id="modoinfo"></span>
        </div>

        <div class="modal-footer">
          <button type="button" id="cancle" class="okok btn btn-default" data-dismiss="modal">취소</button>
          <button type="button" id="delsale" class="okok btn btn-danger" data-dismiss="modal">삭제</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/sh_custom-file-input.js"></script>

  <script>
    $(document).ready(function() {
      $('#delImg').css('display', 'none');
      $('.box').css('display', 'none');
      $('#forms').css('display', 'none');

      // 로그인 회원 정보출력 세션없으면 로그인페이지로
      var no = $.session.get('mno');
      var div = $('#user_info');
      var ul = $('#menu-nav-ul');
      if (no == undefined) {
        div.append("<a href='login.html' id='loginBtn'>로그인</a>")
      } else {
        $('#myMno1').val(no);
        $('#myMno2').val(no);

        div.append(
          "<a role='button' id='msgBtn' class='Msg' href='messagebox.html'>" +
          "<i class='fa fa-envelope-o'></i>" +
          "<span class='badge' id='userBadge'>0</span>" +
          "</a>" +
          "<img src='files/" + $.session.get('mimg') +
          "' id='userImg' />" +
          "<a id='userName' href='mypage.html'>" + $.session.get(
            'mname') + "</a>" +
          "<a role='button' id='outBtn' class='logout'>" +
          "<i class='fa fa-unlock fa-lg'></i>" +
          "</a>")
        ul.append(
          "<li><a href='diary.html'><i class='lnr lnr-book'></i> 다이어리</a></li>"
        )

        // 안읽은 받은쪽지 갯수 출력
        var no = $.session.get('mno');
        var form_data = new FormData();
        form_data.append("recvMno", no)
        $.ajax({
          url: 'message/ajax/noReadMsg.do',
          type: 'post',
          //    async: false,
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          success: function(resultObj) {
            var ajaxResult = resultObj.ajaxResult;
            $('#userBadge').html(ajaxResult.data
              .noReadCount)
          }
        })
      }

      // 로그아웃
      $(document).on("click", "#outBtn", function() {
        $.session.clear();
        location.href = "login.html"
      });


    })

    // 짝짓기 디테일
    var sno = location.href.split('?')[1].split('=')[1];

    var form_data = new FormData();
    form_data.append("sno", sno)
    $.ajax({
      url: "sale/ajax/detail.do",
      dataType: 'json',
      cache: false,
      contentType: false,
      processData: false,
      data: form_data,
      type: 'post',
      success: function(re) {
        var saleinfo = re.sale;
        var mem = re.member;
        console.log(mem.mEmail);
        $('#sendName').val(mem.mEmail);
        $('#modalTitle').html(saleinfo.sTitle);
        $('#contentText').val(saleinfo.sContent);
        $('#msno').val(saleinfo.sno);
        $('#mmtype').val(saleinfo.sType);

        console.log(saleinfo.sno)
        console.log($.session.get('mno'))

        if (saleinfo.mno != $.session.get('mno')) {
          $('#editPet').css('display', 'none');
          $('#matDelBtn').css('display', 'none');
          $('#editEnd').css('display', 'none');
          $('#editCancel').css('display', 'none');
        }

        var form_data = new FormData();
        form_data.append("sno", sno)
        $.ajax({
          url: "files/ajax/slist.do",
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: 'post',
          success: function(re) {
            var files = re.ajaxResult.data;

            var imgs = $('#imgs');
            var dots = $('#dots');
            var showDel = $('#delImg');
            var i = 0;
            for (var file of files) {
              if (i == 0) {
                imgs.append(
                  "<div class='item active'>" +
                  "<img class='slideimg' src='files/" +
                  file.fileName +
                  "'>" +
                  "</div>")
                dots.append(
                  "<li data-target='#carousel-example-generic' data-slide-to='" +
                  i +
                  "' class='active'></li>"
                )
                if (files.length == 1) {
                  showDel.append(
                    "<img src='files/" +
                    file.fileName +
                    "'>")
                } else {
                  showDel.append(
                    "<img src='files/" +
                    file.fileName +
                    "'>" +
                    "<a role='button' id='" +
                    file.fno +
                    "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>"
                  )
                }
              } else {
                imgs.append(
                  "<div class='item'>" +
                  "<img class='slideimg' src='files/" +
                  file.fileName +
                  "'>" +
                  "</div>")
                dots.append(
                  "<li data-target='#carousel-example-generic' data-slide-to='" +
                  i +
                  "'></li>")
                if (files.length == 1) {
                  showDel.append(
                    "<img src='files/" +
                    file.fileName +
                    "'>")
                } else {
                  showDel.append(
                    "<img src='files/" +
                    file.fileName +
                    "'>" +
                    "<a role='button' id='" +
                    file.fno +
                    "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>"
                  )
                }
              }
              i++;
            }
          }
        })
      }
    })

    var i = 0;
    // 댓글 가져오기
    $.ajax({
      url: "comment/ajax/salecomlist.do",
      dataType: 'json',
      cache: false,
      async: false,
      contentType: false,
      processData: false,
      data: form_data,
      type: 'post',
      success: function(re) {
        var commen = re.comments;
        var comdiv = $('#comComment');
        var mem;
        var j = 0;
        for (var com of commen) {
          mem = re.memberMap[j];
          if ($.session.get('mno') == mem.mno) {
            comdiv.append(
              "<div class='comment'>" +
              "<img class='commentimg' src='files/" +
              mem.mImg + "'>" +
              "<div class='commentname'>" + mem.mName +
              "</div>" +
              "<a class='commentDel' id='" + com.comNo +
              "' onclick='del(this.id)'>" +
              "<i class='fa fa-close'></i></a>" +
              "<div class='commenttext'>" + com.comComment +
              "</div>" +
              "</div>")
          } else {
            comdiv.append(
              "<div class='comment'>" +
              "<img class='commentimg' src='files/" +
              mem.mImg + "'>" +
              "<div class='commentname'>" + mem.mName +
              "</div>" +
              "<div class='commenttext'>" + com.comComment +
              "</div>" +
              "</div>")
          }
          j++;
        }
      },
      complete: function() {
        i++;
      }
    })

    $.getJSON('comment/ajax/salepages.do?sno=' + sno, function(resultObj) {
      var ajaxResult = resultObj.ajaxResult
        // console.log(resultObj)
      if (ajaxResult.data == 0 || ajaxResult.data == 1) {
        $('#more').empty();
      }
    })

    // 댓글게시 클릭
    $(document).on("click", "#comDelBtn", function() {
      if ($('#comcontent').val() == "") {

        $('#noCom').modal('show');
        return false;

      } else {
        var form_data = new FormData();
        form_data.append("sno", $('#msno').val())
        form_data.append("comComment", $('#comcontent').val())
        form_data.append("mno", $.session.get('mno'))
        $.ajax({
          url: "comment/ajax/salecom.do",
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: 'post',
          success: function(re) {
            $('#comcontent').val('')
            var form_data = new FormData();
            form_data.append("sno", $('#msno').val())
            $.ajax({
              url: "comment/ajax/salecomlist.do",
              dataType: 'json',
              cache: false,
              contentType: false,
              processData: false,
              data: form_data,
              type: 'post',
              success: function(re) {
                $('#comComment').empty();
                var commen = re.comments;
                var comdiv = $('#comComment');
                var mem;
                var j = 0;
                for (var com of commen) {
                  mem = re.memberMap[j];
                  if ($.session.get('mno') == mem.mno) {
                    comdiv.append(
                      "<div class='comment'>" +
                      "<img class='commentimg' src='files/" +
                      mem
                      .mImg +
                      "'>" +
                      "<div class='commentname'>" +
                      mem
                      .mName +
                      "</div>" +
                      "<a class='commentDel' id='" +
                      com
                      .comNo +
                      "' onclick='del(this.id)'>" +
                      "<i class='fa fa-close'></i></a>" +
                      "<div class='commenttext'>" +
                      com
                      .comComment +
                      "</div>" +
                      "</div>"
                    )
                  } else {
                    comdiv.append(
                      "<div class='comment'>" +
                      "<img class='commentimg' src='files/" +
                      mem
                      .mImg +
                      "'>" +
                      "<div class='commentname'>" +
                      mem
                      .mName +
                      "</div>" +
                      "<div class='commenttext'>" +
                      com
                      .comComment +
                      "</div>" +
                      "</div>"
                    )
                  }
                  j++;
                }
                $('#more').empty();
                $.getJSON(
                  'comment/ajax/salepages.do?sno=' +
                  sno,
                  function(resultObj) {
                    var ajaxResult = resultObj.ajaxResult
                    if (ajaxResult.data == 0 || ajaxResult.data == 1) {
                      $('#more').empty();
                    } else {
                      $('#more').append('<a role="button" class="moreBtn" id="m10" onclick="moree(this.id);">더보기</a>');
                    }
                  })
                i = 1;
              }
            })
          }
        })
      }
    })

    // 더보기
    function moree(id) {
      i++;
      console.log(id);
      var page = id.substring(1);
      console.log(page);
      var cpage = i;
      var form_data = new FormData();
      form_data.append("sno", sno)
      form_data.append("pageNo", page)
      $.ajax({
        url: "comment/ajax/salecomlist.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          var commen = re.comments;
          var comdiv = $('#comComment');
          var mem;
          var j = 0;
          for (var com of commen) {
            mem = re.memberMap[j];
            if ($.session.get('mno') == mem.mno) {
              comdiv.append(
                "<div class='comment'>" +
                "<img class='commentimg' src='files/" +
                mem.mImg + "'>" +
                "<div class='commentname'>" +
                mem.mName + "</div>" +
                "<a class='commentDel' id='" +
                com.comNo +
                "' onclick='del(this.id)'>" +
                "<i class='fa fa-close'></i></a>" +
                "<div class='commenttext'>" +
                com.comComment + "</div>" +
                "</div>")
            } else {
              comdiv.append(
                "<div class='comment'>" +
                "<img class='commentimg' src='files/" +
                mem.mImg + "'>" +
                "<div class='commentname'>" +
                mem.mName + "</div>" +
                "<div class='commenttext'>" +
                com.comComment + "</div>" +
                "</div>")
            }
            j++;
          }
          $.getJSON('comment/ajax/salepages.do?sno=' +
            sno,
            function(resultObj) {
              var ajaxResult = resultObj.ajaxResult;
              console.log(cpage);
              if (ajaxResult.data == cpage) {
                console.log("더보기 끝")
                $('#more').empty();

              } else {
                console.log("더보기 생성")
                var more = $('#more');
                $('#more').empty();
                var i = parseInt(page) + 10;
                console.log(i);
                more.append(
                  "<a role='button' class='moreBtn' id='m" +
                  i +
                  "' onclick='moree(this.id);'>더보기</a>"
                )
              }
            })
        }
      })
    };


    // 댓글 삭제
    $(document).on("click", "#delCom", function() {
      var form_data = new FormData();
      console.log($('#comno').val())
      form_data.append("comNo", $('#comno').val())
      $.ajax({
        url: "comment/ajax/delete.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          $('#checkModal').modal('hide')
          var form_data = new FormData();
          form_data.append("sno", $('#msno').val())
          $.ajax({
            url: "comment/ajax/salecomlist.do",
            dataType: 'json',
            cache: false,
            contentType: false,
            processData: false,
            data: form_data,
            type: 'post',
            success: function(re) {
              $('#comComment').empty();
              var commen = re.comments;
              var comdiv = $(
                '#comComment'
              );
              var mem;
              var j = 0;
              for (var com of commen) {
                mem = re.memberMap[
                  j];
                comdiv.append(
                  "<div class='comment'>" +
                  "<img class='commentimg' src='files/" +
                  mem.mImg +
                  "'>" +
                  "<div class='commentname'>" +
                  mem.mName +
                  "</div>" +
                  "<a class='commentDel' id='" +
                  com.comNo +
                  "' onclick='del(this.id)'>" +
                  "<i class='fa fa-close'></i></a>" +
                  "<div class='commenttext'>" +
                  com.comComment +
                  "</div>" +
                  "</div>"
                )
                j++;
              }
              $('#more').empty();
              $.getJSON(
                'comment/ajax/salepages.do?sno=' + sno, function(resultObj) {
                  var ajaxResult = resultObj.ajaxResult

                  if (ajaxResult.data == 0 || ajaxResult.data == 1) {
                    $('#more').empty();
                  } else {
                    $('#more').append('<a role="button" class="moreBtn" id="m10" onclick="moree(this.id);">더보기</a>');
                  }
                })
              i = 1;
            }
          })
        }
      })
    })

    // 짝짓기 삭제
    $(document).on('click', '#matDelBtn', function() {
      $('#modoinfo').html('삭제 하시겠습니까?');
      $('#modo').modal('show');
    });

    $(document).on('click', '#delsale', function() {
      $.ajax({
        url: 'sale/ajax/delete.do',
        dataType: 'json',
        type: 'get',
        data: {
          "sno": sno
        },
        success: function(ro) {
          location.href = 'sale.html';
        }
      })
    })

    // 디테일 변경 누르면 발생
    $(document).on("click", "#editPet", function() {
      $("textarea[id=contentText]").attr("readonly", false);
      $("textarea[class=commentin]").attr("readonly", true);
      $('.box').css('display', '');
      $('.commentin').css('display', 'none');
      $('#comDelBtn').css('display', 'none');
      $('#forms').css('display', '');
      $("button[id=comDelBtn]").attr("disabled", true);
      $('#editPet').css('display', 'none');
      $('#matDelBtn').css('display', 'none');
      $('#editEnd').css('display', '');
      $('#editCancel').css('display', '');
      $('.comments').css('display', 'none');
      $('#delImg').css('display', '');
      $('#contentText').css('background-color', '#ffffff');
      $('#contentText').css('color', '#2d335e');
    })

    // 변경 상태에서 취소 누르면 발생
    $(document).on("click", "#editCancel", function() {
      $("textarea[id=contentText]").attr("readonly", true);
      $("textarea[class=commentin]").attr("readonly", false);
      $('.box').css('display', 'none');
      $('.commentin').css('display', '');
      $('#comDelBtn').css('display', '');
      $('#forms').css('display', 'none');
      $("button[id=comDelBtn]").attr("disabled", false);
      $('#editPet').css('display', '');
      $('#matDelBtn').css('display', '');
      $('#editEnd').css('display', 'none');
      $('#editCancel').css('display', 'none');
      $('.comments').css('display', '');
      $('#delImg').css('display', 'none');
      $('#contentText').css('background-color', '#ffd800');
      $('#contentText').css('color', '#2d335e');
    })

    // 디테일 변경완료 누르면 발생
    $(document).on("click", "#editEnd", function() {
      $("textarea[id=contentText]").attr("readonly", true);
      $("textarea[class=commentin]").attr("readonly", false);
      $('.box').css('display', 'none');
      $('.commentin').css('display', '');
      $('#comDelBtn').css('display', '');
      $('#forms').css('display', 'none');
      $("button[id=comDelBtn]").attr("disabled", false);
      $('#editPet').css('display', '');
      $('#matDelBtn').css('display', '');
      $('#editEnd').css('display', 'none');
      $('#editCancel').css('display', 'none');
      $('.comments').css('display', '');
      $('#delImg').css('display', 'none');
      $('#contentText').css('background-color', '#ffd800');
      $('#contentText').css('color', '#2d335e');

      var form_data = new FormData();
      form_data.append("sno", $('#msno').val())
      form_data.append("sContent", $('#contentText').val())
      form_data.append("sType", $('#mmtype').val())
      $.ajax({
        url: "sale/ajax/update.do",
        dataType: 'json',
        cache: false,
        async: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          console.log("디테일 변경 성공")
          for (var i = 0; i < $("#file-1").prop(
              "files").length; i++) {
            var file_data = $("#file-1").prop(
              "files")[i];
            var file_name = file_data.name;
            var form_data = new FormData();
            form_data.append("file", file_data)
            form_data.append("fName", file_name)
            form_data.append("sno", $('#msno').val())
            $.ajax({
              url: "files/ajax/sUpload.do",
              dataType: 'json',
              cache: false,
              async: false,
              contentType: false,
              processData: false,
              data: form_data,
              type: 'post',
              success: function(
                resultObj) {
                console.log(
                  file_name
                )

              }
            })
          }
          location.href = 'saleDetail.html?sno=' +
            $('#msno').val();
        }
      })
    })

    //댓글 삭제 도우미
    function del(id) {
      $('#comno').val(id)
      $('#checkModal').modal('show')
    }

    // 디테일 모달 속 이미지 하나하나 지우기
    function imgDel(id) {
      console.log("fno : " + id)
      var form_data = new FormData();
      form_data.append("fno", id)
      $.ajax({
        url: "files/ajax/delOneImg.do",
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        type: 'post',
        success: function(re) {
          console.log("이미지 삭제 성공")

          var form_data = new FormData();
          form_data.append("sno", $('#msno').val())
          console.log("sno : " + $('#msno').val())
          $.ajax({
            url: "files/ajax/slist.do",
            dataType: 'json',
            cache: false,
            contentType: false,
            processData: false,
            data: form_data,
            type: 'post',
            success: function(re) {
              var files = re.ajaxResult.data;
              console.log(files);
              $('#imgs').empty();
              $('#dots').empty();
              $('#delImg').empty();
              var imgs = $('#imgs');
              var dots = $('#dots');
              var showDel = $('#delImg');
              var i = 0;
              for (var file of files) {
                if (i == 0) {
                  imgs.append(
                    "<div class='item active'>" +
                    "<img class='slideimg' src='files/" +
                    file.fileName +
                    "'>" +
                    "</div>")
                  dots.append(
                    "<li data-target='#carousel-example-generic' data-slide-to='" +
                    i +
                    "' class='active'></li>"
                  )
                  if (files.length == 1) {
                    showDel.append(
                      "<img src='files/" +
                      file.fileName +
                      "'>")
                  } else {
                    showDel.append(
                      "<img src='files/" +
                      file.fileName +
                      "'>" +
                      "<a role='button' id='" +
                      file.fno +
                      "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>"
                    )
                  }

                } else {
                  imgs.append(
                    "<div class='item'>" +
                    "<img class='slideimg' src='files/" +
                    file.fileName +
                    "'>" +
                    "</div>")
                  dots.append(
                    "<li data-target='#carousel-example-generic' data-slide-to='" +
                    i +
                    "'></li>")
                  if (files.length ==
                    1) {
                    showDel.append(
                      "<img src='files/" +
                      file.fileName +
                      "'>")
                  } else {
                    showDel.append(
                      "<img src='files/" +
                      file.fileName +
                      "'>" +
                      "<a role='button' id='" +
                      file.fno +
                      "' onclick='imgDel(this.id)'><i class='fa fa-times'></i></a>"
                    )
                  }
                }
                i++;
              }
            }
          })
        }
      });
    }

    //쪽지보내기
    $(document).on("click", "#sendMsgBtn", function() {

      var no = $.session.get('mno');
      var sendEmail = $('#sendName').val();
      var form_data = new FormData();
      form_data.append("sendMno", no);
      form_data.append("mEmail", sendEmail);
      form_data.append("msgContent", $('#msgText').val())
      $.ajax({
        url: 'message/ajax/send.do',
        type: 'post',
        async: false,
        dataType: 'json',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,
        success: function(resultObj) {
          $('#sendMsg').modal('hide')
          $('#modoinfo').html('메시지를 성공적으로 보냈습니다.');
          $('#modo').modal('show')
        }
      })
    })
  </script>
</body>

</html>
