<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>키워드로 장소검색하기</title>
  <link rel="stylesheet" href="../lib/bootstrap/dist/css/bootstrap.css">
  <script src="../lib/jquery/jquery.min.js"></script>
</head>

<body>

  <div id="map" style="width: 480px;height: 480px;"></div>
  <div>
    <input id="pet" type="button" class="btn btn-primary" value="동물병원">
    <input id="pet" type="button" class="btn btn-primary" value="애견용품">
    <input id="pet" type="button" class="btn btn-primary" value="애견카페">
  </div>
  <p>
    <button onclick="hideMarkers()">마커 감추기</button>
    <button onclick="showMarkers()">마커 보이기</button>
  </p>
  <script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=d6f32883b1f882092688e8062e26dd77&libraries=services,clusterer"></script>


  <script>
    // 마커를 클릭하면 장소명을 표출할 인포윈도우 입니다
    var infowindow = new daum.maps.InfoWindow({
      zIndex: 1,
      removable: true
    });
    // 전역 변수들....
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
      mapOption = {
        center: new daum.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
      };
    var markers = [];

    // 지도를 생성합니다
    var map = new daum.maps.Map(mapContainer, mapOption);

    // 타입 설정
    var mapTypeControl = new daum.maps.MapTypeControl();
    map.addControl(mapTypeControl, daum.maps.ControlPosition.TOPRIGHT);

    // 장소 검색 객체를 생성합니다
    var ps = new daum.maps.services.Places();

    $(document).on("click", "#pet", function(event) {
      console.log(event.target)
      ps.keywordSearch({
        keyword: event.target.value,
        callback: placesSearchCB,
        radius: 2000,
        location: new daum.maps.LatLng(37.566826, 126.9786567)
      })
    });


    // navigator.geolocation.getCurrentPosition(function(position) {
    //   var lat = position.coords.latitude, // 위도
    //     lon = position.coords.longitude; // 경도
    //   var locPosition = new daum.maps.LatLng(lat, lon) // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
    //
    //   console.log(locPosition)
    //       $(document).on("click", "#pet", function(event) {
    //           console.log(event.target)
    //         ps.keywordSearch({
    //           keyword: event.target.value,
    //           callback: placesSearchCB,
    //           radius: 1000,
    //           location: locPosition
    //         })
    //       });
    // });
    // 키워드로 장소를 검색합니다


    // 키워드 검색 완료 시 호출되는 콜백함수 입니다
    function placesSearchCB(status, data, pagination) {
      if (status === daum.maps.services.Status.OK) {
        console.log(data)
          // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
          // LatLngBounds 객체에 좌표를 추가합니다
        var bounds = new daum.maps.LatLngBounds();
        setMarkers(null);
        for (var i = 0; i < data.places.length; i++) {
          displayMarker(data.places[i]);
          bounds.extend(new daum.maps.LatLng(data.places[i].latitude, data.places[
            i].longitude));
        }

        // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
        map.setBounds(bounds);
      }
    }

    // 지도에 마커를 표시하는 함수입니다
    function displayMarker(place) {

      // 마커를 생성하고 지도에 표시합니다
      var marker = new daum.maps.Marker({
        map: map,
        clickable: true,
        position: new daum.maps.LatLng(place.latitude, place.longitude)
      });
      markers.push(marker);
      // 마커에 클릭이벤트를 등록합니다
      daum.maps.event.addListener(marker, 'click', function() {
        // 마커를 클릭하면 장소명이 인포윈도우에 표출됩니다
        infowindow.setContent('<div style="padding:5px;font-size:12px;">' +
          place.title + '</div>');
        infowindow.open(map, marker);
      });
    }

    function setMarkers(map) {
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
      }
    }

    // // "마커 보이기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에 표시하는 함수입니다
    // function showMarkers() {
    //   setMarkers(map)
    // }
    //
    // // "마커 감추기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에서 삭제하는 함수입니다
    // function hideMarkers() {
    //   setMarkers(null);
    // }
  </script>


</body>

</html>
