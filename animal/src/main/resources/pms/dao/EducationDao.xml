<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="pms.dao.EducationDao">
  <resultMap type="education" id="educationMap">
    <id column="EDU_NUM" property="eduNo" />
    <result column="MEM_NUM" property="mno" />
    <result column="EDU_VIEWS" property="eduViews" />
    <result column="EDU_CRE" property="eduCreateDate" />
    <result column="CRE_TITLE" property="eduTitle" />
    <result column="EDU_CONTENT" property="eduContent" />
    <result column="EDU_TYPE" property="eduType" /> 
  </resultMap>
  
  <select id="educationList" resultMap="educationMap" parameterType="int">
    select
      EDU_NUM as eduNo,
      EDU_TITLE as eduTitle,
      EDU_SPEC as eduSpec,
      EDU_CRE as eduCreateDate,
      EDU_VIEWS as eduViews
    from Education 
    order by EDU_NUM desc
      limit #{startIndex}, 8
  </select>
  
  <select id="educationLast" resultMap="educationMap">
    select *
    from education
  </select>
  
  <select id="count" resultMap="educationMap">
    select count(*) as count from education
  </select>
    
  <update id="addViews" parameterType="int">
    update Education set
      EDU_VIEWS = EDU_VIEWS + 1
    where EDU_NUM=#{value}
  </update>
  
  <select id="selectOne" resultMap="educationMap" parameterType="int">
    select
      edu.EDU_NUM as eduNo,
      edu.EDU_TITLE as eduTitle,
      edu.EDU_CONTENT as eduContent,
      edu.EDU_CRE as eduCreateDate,
      edu.EDU_VIEWS as eduViews,
      f.FILE_NUM as fNo,
      f.FILE_NAME as fName,
      c.CMT_NUM as cNo,
      c.CMT_CONTENT as cContent
    from Education edu
      left outer join Files f on edu.EDU_NUM = f.EDU_NUM
      left outer join Comment c on f.EDU_NUM = c.EDU_NUM
    where edu.EDU_NUM = #{value}
  </select>
  
  <insert id="insert" parameterType="education">
    insert into education(MEM_NUM,EDU_CRE,EDU_TITLE,EDU_CONTENT,EDU_SPEC)
    values(#{mno},now(),#{eduTitle},#{eduContent},#{eduSpec})
  </insert>
  
</mapper>