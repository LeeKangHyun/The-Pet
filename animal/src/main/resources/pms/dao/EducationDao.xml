<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="pms.dao.EducationDao">
  <resultMap type="education" id="educationMap">
    <id column="EDU_NUM" property="eduNo" />
    <result column="MEM_NUM" property="mno" />
    <result column="EDU_VIEWS" property="eduViews" />
    <result column="EDU_CRE" property="eduCreateDate" />
    <result column="CRE_TITLE" property="eduTitle" />
    <result column="EDU_CONTENT" property="eduContent" />
    <result column="EDU_TYPE" property="eduType" />  
  </resultMap>
  
  <select id="selectList" resultMap="educationMap" parameterType="map">
    select
      edu.EDU_NUM as eduNo,
      edu.EDU_TITLE as eduTitle,
      edu.EDU_SPEC as eduSpec,
      edu.EDU_CRE as eduCreateDate,
      edu.EDU_VIEWS as eduViews,
      f.FILE_NUM as fNo,
      f.FILE_NAME as fName
    from Education edu
      left outer join Files f on edu.EDU_NUM = f.EDU_NUM
    order by
    <choose>
      <otherwise>EDU_CRE </otherwise>
    </choose>
    <choose>
      <when test="align == 'asc'">asc</when>
      <otherwise>desc</otherwise>
    </choose>
  </select>
    
  <update id="addViews" parameterType="int">
    update Education set
      EDU_VIEWS = EDU_VIEWS + 1
    where EDU_NUM=#{value}
  </update>
  
  <select id="selectOne" resultMap="educationMap" parameterType="int">
    select
      edu.EDU_NUM as eduNo,
      edu.EDU_TITLE as eduTitle,
      edu.EDU_CONTENT as eduContent,
      edu.EDU_CRE as eduCreateDate,
      edu.EDU_VIEWS as eduViews,
      f.FILE_NUM as fNo,
      f.FILE_NAME as fName,
      c.CMT_NUM as cNo,
      c.CMT_CONTENT as cContent
    from Education edu
      left outer join Files f on edu.EDU_NUM = f.EDU_NUM
      left outer join Comment c on f.EDU_NUM = c.EDU_NUM
    where edu.EDU_NUM = #{value}
  </select>
  
</mapper>